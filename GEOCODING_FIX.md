# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –∑ –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è–º –∞–¥—Ä–µ—Å

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:
–ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∞–¥—Ä–µ—Å –≤–∏–Ω–∏–∫–∞—î –ø–æ–º–∏–ª–∫–∞:
```
ERROR - ‚ùå Geocoding API REQUEST_DENIED: The provided API key is invalid.
```

–ê–ª–µ –ø—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ —Ç–∞–∫—Å—ñ –≤—Å–µ –ø—Ä–∞—Ü—é—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

---

## ‚úÖ –©–æ –±—É–ª–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. **–î–æ–¥–∞–Ω–æ Reverse Geocoding** (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ ‚Üí –∞–¥—Ä–µ—Å–∞)
- –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î **–≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é**, —Ç–µ–ø–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞
- –§—É–Ω–∫—Ü—ñ—è `reverse_geocode()` –≤ `app/utils/maps.py`
- –ó–∞–º—ñ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —á–∏—Ç–∞–±–µ–ª—å–Ω–∞ –∞–¥—Ä–µ—Å–∞

### 2. **–î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è**
–¢–µ–ø–µ—Ä –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ –≤–∏–¥–Ω–æ:
```
üîë API –∫–ª—é—á –ø—Ä–∏—Å—É—Ç–Ω—ñ–π, –≥–µ–æ–∫–æ–¥—É—é: –≤—É–ª–∏—Ü—è –•—Ä–µ—â–∞—Ç–∏–∫ 15
‚úÖ –ì–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ: 50.4501, 30.5234
```

–ê–±–æ —è–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞:
```
‚ö†Ô∏è Google Maps API –∫–ª—é—á –≤—ñ–¥—Å—É—Ç–Ω—ñ–π
‚ö†Ô∏è –ì–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è –Ω–µ –≤–¥–∞–ª–æ—Å—å –¥–ª—è: –≤—É–ª–∏—Ü—è...
```

---

## üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

–ü—ñ—Å–ª—è –¥–µ–ø–ª–æ—é –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:

### **–Ø–∫—â–æ –±–∞—á–∏—Ç–µ:**
```
‚ö†Ô∏è Google Maps API –∫–ª—é—á –≤—ñ–¥—Å—É—Ç–Ω—ñ–π
```

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `.env` —Ñ–∞–π–ª
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ `GOOGLE_MAPS_API_KEY=–≤–∞—à_–∫–ª—é—á`
3. –ù–∞ Render: Settings ‚Üí Environment ‚Üí –¥–æ–¥–∞—Ç–∏ `GOOGLE_MAPS_API_KEY`

### **–Ø–∫—â–æ –±–∞—á–∏—Ç–µ:**
```
‚ùå Geocoding API REQUEST_DENIED: The provided API key is invalid.
```

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
2. Google Cloud Console ‚Üí APIs & Services ‚Üí Enable APIs
3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å **Geocoding API** (–Ω–µ —Ç—ñ–ª—å–∫–∏ Distance Matrix)
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ billing (–ø–ª–∞—Ç—ñ–∂–Ω–∏–π –º–µ—Ç–æ–¥ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π)

### **–Ø–∫—â–æ –±–∞—á–∏—Ç–µ:**
```
üîë API –∫–ª—é—á –ø—Ä–∏—Å—É—Ç–Ω—ñ–π, –≥–µ–æ–∫–æ–¥—É—é: –∞–¥—Ä–µ—Å–∞
‚ùå Geocoding API REQUEST_DENIED...
```

**–¶–µ –æ–∑–Ω–∞—á–∞—î:**
- –ö–ª—é—á –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ê–ª–µ Google –≤—ñ–¥—Ö–∏–ª—è—î –∑–∞–ø–∏—Ç
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Google Cloud Console:
  - Geocoding API —É–≤—ñ–º–∫–Ω–µ–Ω–æ?
  - –û–±–º–µ–∂–µ–Ω–Ω—è API (restrictions)?
  - –ö–≤–æ—Ç–∏ –Ω–µ –≤–∏—á–µ—Ä–ø–∞–Ω—ñ?

---

## üöÄ –ö–æ–¥ –∑–º—ñ–Ω:

### `app/utils/maps.py` - –¥–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é:
```python
async def reverse_geocode(api_key: str, lat: float, lon: float) -> Optional[str]:
    """–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ ‚Üí –∞–¥—Ä–µ—Å–∞"""
    url = f"https://maps.googleapis.com/maps/api/geocode/json?latlng={lat},{lon}&key={api_key}&language=uk"
    # ... –æ–±—Ä–æ–±–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
```

### `app/handlers/saved_addresses.py`:
```python
# –ü—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó:
if config.google_maps_api_key:
    logger.info(f"üîë API –∫–ª—é—á –ø—Ä–∏—Å—É—Ç–Ω—ñ–π, reverse geocoding...")
    readable_address = await reverse_geocode(...)
    if readable_address:
        address = readable_address  # –ó–±–µ—Ä–µ–≥—Ç–∏ —á–∏—Ç–∞–±–µ–ª—å–Ω—É –∞–¥—Ä–µ—Å—É
```

---

## üìä –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:

### **–¢–µ—Å—Ç 1: –ó–±–µ—Ä–µ–∂–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ (—Ç–µ–∫—Å—Ç)**
1. –ö–ª—ñ—î–Ω—Ç ‚Üí üìç –ú–æ—ó –∞–¥—Ä–µ—Å–∏ ‚Üí ‚ûï –î–æ–¥–∞—Ç–∏
2. –í–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤—É: "–î–æ–¥–æ–º—É"
3. –í–∏–±—Ä–∞—Ç–∏ –µ–º–æ–¥–∑—ñ: üè†
4. –í–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–º: "–≤—É–ª–∏—Ü—è –•—Ä–µ—â–∞—Ç–∏–∫ 15, –ö–∏—ó–≤"
5. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** –∞–¥—Ä–µ—Å–∞ –≥–µ–æ–∫–æ–¥—É—î—Ç—å—Å—è —ñ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏

**–õ–æ–≥ –º–∞—î –±—É—Ç–∏:**
```
üîë API –∫–ª—é—á –ø—Ä–∏—Å—É—Ç–Ω—ñ–π, –≥–µ–æ–∫–æ–¥—É—é: –≤—É–ª–∏—Ü—è –•—Ä–µ—â–∞—Ç–∏–∫ 15, –ö–∏—ó–≤
‚úÖ –ì–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ: 50.4501, 30.5234
```

### **–¢–µ—Å—Ç 2: –ó–±–µ—Ä–µ–∂–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ (–≥–µ–æ–ª–æ–∫–∞—Ü—ñ—è)**
1. –ö–ª—ñ—î–Ω—Ç ‚Üí üìç –ú–æ—ó –∞–¥—Ä–µ—Å–∏ ‚Üí ‚ûï –î–æ–¥–∞—Ç–∏
2. –í–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤—É: "–†–æ–±–æ—Ç–∞"
3. –í–∏–±—Ä–∞—Ç–∏ –µ–º–æ–¥–∑—ñ: üíº
4. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "üìç –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é"
5. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –≤ –∞–¥—Ä–µ—Å—É

**–õ–æ–≥ –º–∞—î –±—É—Ç–∏:**
```
üîë API –∫–ª—é—á –ø—Ä–∏—Å—É—Ç–Ω—ñ–π, reverse geocoding: 50.4501, 30.5234
‚úÖ Reverse geocoded: –≤—É–ª–∏—Ü—è –•—Ä–µ—â–∞—Ç–∏–∫, 15, –ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞
```

---

## üîë Google Cloud Console - Checklist:

1. ‚úÖ **APIs & Services ‚Üí Library**
   - Geocoding API (ENABLED)
   - Distance Matrix API (ENABLED)

2. ‚úÖ **APIs & Services ‚Üí Credentials**
   - API key —ñ—Å–Ω—É—î
   - –ë–µ–∑ IP –æ–±–º–µ–∂–µ–Ω—å (–∞–±–æ –¥–æ–¥–∞—Ç–∏ IP Render)
   - –ë–µ–∑ application restrictions

3. ‚úÖ **Billing**
   - –ü–ª–∞—Ç—ñ–∂–Ω–∏–π –º–µ—Ç–æ–¥ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π
   - $200 –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –Ω–∞ –º—ñ—Å—è—Ü—å
   - Geocoding: $5 –Ω–∞ 1000 –∑–∞–ø–∏—Ç—ñ–≤ (–ø—ñ—Å–ª—è free tier)

4. ‚úÖ **Quotas**
   - Geocoding API: –Ω–µ –¥–æ—Å—è–≥–Ω—É—Ç–æ –ª—ñ–º—ñ—Ç—É
   - Distance Matrix API: –Ω–µ –¥–æ—Å—è–≥–Ω—É—Ç–æ –ª—ñ–º—ñ—Ç—É

---

## üéØ –í–∏—Å–Ω–æ–≤–æ–∫:

**–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ –∫–æ–¥—ñ** - –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—î API –∫–ª—é—á.

**–ü—Ä–æ–±–ª–µ–º–∞ —à–≤–∏–¥—à–µ –∑–∞ –≤—Å–µ:**
1. Geocoding API –Ω–µ —É–≤—ñ–º–∫–Ω–µ–Ω–æ –≤ Google Cloud
2. –ê–±–æ billing –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ
3. –ê–±–æ –æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ API key

**–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:**
1. –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å –ª–æ–≥–∏ –ø—ñ—Å–ª—è –¥–µ–ø–ª–æ—é (–∑ –Ω–æ–≤–∏–º –ª–æ–≥—É–≤–∞–Ω–Ω—è–º)
2. –Ø–∫—â–æ "‚ö†Ô∏è API –∫–ª—é—á –≤—ñ–¥—Å—É—Ç–Ω—ñ–π" ‚Üí –¥–æ–¥–∞—Ç–∏ –≤ Render env
3. –Ø–∫—â–æ "REQUEST_DENIED" ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Google Cloud Console
4. –ó–≤–µ—Ä–Ω—É—Ç–∏ —É–≤–∞–≥—É —á–∏ –ø—Ä–∞—Ü—é—î Distance Matrix (–ø—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ) - —è–∫—â–æ —Ç–∞–∫, —Ç–æ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —ñ —Ç—Ä–µ–±–∞ —Ç—ñ–ª—å–∫–∏ —É–≤—ñ–º–∫–Ω—É—Ç–∏ Geocoding API

---

## üìù –ö–æ–º—ñ—Ç–∏:

```
2b7859d - fix: –î–æ–¥–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ geocoding
deaa9e6 - fix: –î–æ–¥–∞—Ç–∏ logger –≤ saved_addresses
54af4ff - fix: –î–æ–¥–∞–Ω–æ reverse geocoding –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∞–¥—Ä–µ—Å
```

–í—Å—ñ –∑–º—ñ–Ω–∏ –∑–∞–ø—É—à–µ–Ω—ñ –Ω–∞ `fix-taxi-bot` ‚úÖ
