# üìñ –î–æ–≤—ñ–¥–Ω–∏–∫ –∫–æ–º–∞–Ω–¥ —Ç–∞ API

## üéÆ –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### `/start`
–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
–í—ñ—Ç–∞—î–º–æ —É —Ç–∞–∫—Å—ñ-–±–æ—Ç—ñ! –û—Å—å –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é.

[–ó–∞–º–æ–≤–∏—Ç–∏ —Ç–∞–∫—Å—ñ] [–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è]
[–°—Ç–∞—Ç–∏ –≤–æ–¥—ñ—î–º]   [–î–æ–ø–æ–º–æ–≥–∞]
```

---

### `/help`
–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–¥–∫–∏

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–ó–∞–º–æ–≤–∏—Ç–∏ —Ç–∞–∫—Å—ñ' —â–æ–± –æ—Ñ–æ—Ä–º–∏—Ç–∏ –ø–æ—ó–∑–¥–∫—É.
'–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è' ‚Äî —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å –∫–ª—ñ—î–Ω—Ç–∞.
'–°—Ç–∞—Ç–∏ –≤–æ–¥—ñ—î–º' ‚Äî –ø–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É –≤–æ–¥—ñ—è.
```

---

## üë§ –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤

### `/client`
–ü–∞–Ω–µ–ª—å –∫–ª—ñ—î–Ω—Ç–∞

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
üë§ –ü—Ä–æ—Ñ—ñ–ª—å –∫–ª—ñ—î–Ω—Ç–∞

–Ü–º'—è: [–í–∞—à–µ —ñ–º'—è]
–¢–µ–ª–µ—Ñ–æ–Ω: +380...
–ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ: 2025-10-14

[üöñ –ó–∞–º–æ–≤–∏—Ç–∏ —Ç–∞–∫—Å—ñ] [üìú –ú–æ—è —ñ—Å—Ç–æ—Ä—ñ—è]
[‚ÑπÔ∏è –î–æ–ø–æ–º–æ–≥–∞]      [‚≠êÔ∏è –ú—ñ–π —Ä–µ–π—Ç–∏–Ω–≥]
```

---

### `/order`
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–∫—Å—ñ

**–ü—Ä–æ—Ü–µ—Å:**
1. –í–≤–µ–¥–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ
2. –í–≤–µ–¥–µ–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
3. –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –∞–±–æ –∞–¥—Ä–µ—Å–∏ –ø–æ—á–∞—Ç–∫—É
4. –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
5. –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä
6. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è

**–ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:**
```
‚úÖ –î—è–∫—É—î–º–æ! –í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ1 –ø—Ä–∏–π–Ω—è—Ç–æ.
üîç –®—É–∫–∞—î–º–æ –≤–æ–¥—ñ—è...
‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –≤–æ–¥—ñ—è!
```

---

### `/my_rating`
–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–≤—ñ–π —Ä–µ–π—Ç–∏–Ω–≥

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
‚≠êÔ∏è –í–∞—à —Ä–µ–π—Ç–∏–Ω–≥

‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è
–°–µ—Ä–µ–¥–Ω—è –æ—Ü—ñ–Ω–∫–∞: 5.00/5
```

---

## üöó –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –≤–æ–¥—ñ—ó–≤

### `/driver`
–ü–∞–Ω–µ–ª—å –≤–æ–¥—ñ—è

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
üöó –ü–∞–Ω–µ–ª—å –≤–æ–¥—ñ—è

–°—Ç–∞—Ç—É—Å: üü¢ –û–Ω–ª–∞–π–Ω
–ü–Ü–ë: –Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤–∏—á
–ê–≤—Ç–æ: Toyota Camry (–ê–ê1234–í–í)

üí∞ –ó–∞—Ä–æ–±—ñ—Ç–æ–∫ —Å—å–æ–≥–æ–¥–Ω—ñ: 150.00 –≥—Ä–Ω
üí∏ –ö–æ–º—ñ—Å—ñ—è –¥–æ —Å–ø–ª–∞—Ç–∏: 3.00 –≥—Ä–Ω
üíµ –ß–∏—Å—Ç–∏–π –∑–∞—Ä–æ–±—ñ—Ç–æ–∫: 147.00 –≥—Ä–Ω

[üü¢ –û–Ω–ª–∞–π–Ω]    [üìä –ó–∞—Ä–æ–±—ñ—Ç–æ–∫]
[üìú –Ü—Å—Ç–æ—Ä—ñ—è]   [üí≥ –ö–æ–º—ñ—Å—ñ—è]
[üìç –û–Ω–æ–≤–∏—Ç–∏ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é]
```

---

### `/register_driver`
–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —è–∫ –≤–æ–¥—ñ–π

**–ü—Ä–æ—Ü–µ—Å:**
1. –ü–Ü–ë
2. –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É
3. –ú–∞—Ä–∫–∞ –∞–≤—Ç–æ
4. –ú–æ–¥–µ–ª—å –∞–≤—Ç–æ
5. –ù–æ–º–µ—Ä–Ω–∏–π –∑–Ω–∞–∫
6. –§–æ—Ç–æ –ø–æ—Å–≤—ñ–¥—á–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
–ó–∞—è–≤–∫—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—é. –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.
```

---

### `/my_driver_status`
–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –≤–æ–¥—ñ—è

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏: approved
–ê–≤—Ç–æ: Toyota Camry (–ê–ê1234–í–í)
```

**–ú–æ–∂–ª–∏–≤—ñ —Å—Ç–∞—Ç—É—Å–∏:**
- `pending` - –ù–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—ó
- `approved` - –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ
- `rejected` - –í—ñ–¥—Ö–∏–ª–µ–Ω–æ

---

## üëë –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### `/admin`
–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
üîê –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å

–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é:

[üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]      [üë• –ú–æ–¥–µ—Ä–∞—Ü—ñ—è –≤–æ–¥—ñ—ó–≤]
[üí∞ –¢–∞—Ä–∏—Ñ–∏]          [üìã –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è]
[üì¢ –†–æ–∑—Å–∏–ª–∫–∞]        [‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è]
```

---

### `/orders`
–®–≤–∏–¥–∫–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
üìã –û—Å—Ç–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:

‚úîÔ∏è ‚Ññ1 (completed)
–ö–ª—ñ—î–Ω—Ç: –ü–µ—Ç—Ä–µ–Ω–∫–æ –ü–µ—Ç—Ä–æ (+380671111111)
–ú–∞—Ä—à—Ä—É—Ç: geo:... ‚Üí ...
–°—Ç–≤–æ—Ä–µ–Ω–æ: 2025-10-14 14:30
–í–∞—Ä—Ç—ñ—Å—Ç—å: 72.00 –≥—Ä–Ω
```

---

### `/pending_drivers`
–®–≤–∏–¥–∫–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ –∑–∞—è–≤–æ–∫ –≤–æ–¥—ñ—ó–≤

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
#1 –Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤–∏—á (+380501234567)
–ê–≤—Ç–æ: Toyota Camry (–ê–ê1234–í–í)
–°—Ç–∞—Ç—É—Å: pending

[‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏] [‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏]
```

---

### `/approve_driver <id>`
–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–æ–¥—ñ—è –∑–∞ ID

**–ü—Ä–∏–∫–ª–∞–¥:**
```
/approve_driver 1
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
–í–æ–¥—ñ—è #1 –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ.
```

---

### `/reject_driver <id>`
–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –∑–∞—è–≤–∫–∏ –≤–æ–¥—ñ—è –∑–∞ ID

**–ü—Ä–∏–∫–ª–∞–¥:**
```
/reject_driver 1
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```
–ó–∞—è–≤–∫—É #1 –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ.
```

---

## üéπ Inline-–∫–Ω–æ–ø–∫–∏ (Callback Actions)

### –î–ª—è –≤–æ–¥—ñ—ó–≤ (–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è):

#### `order:accept:<order_id>`
–ü—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

**–ü—Ä–∏–∫–ª–∞–¥:** `order:accept:1`

**–ï—Ñ–µ–∫—Ç:**
- –°—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Üí `accepted`
- –ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º—É—î –¥–∞–Ω—ñ –≤–æ–¥—ñ—è
- –í–æ–¥—ñ–π –º–æ–∂–µ –ø–æ—á–∞—Ç–∏ –ø–æ—ó–∑–¥–∫—É

---

#### `order:reject:<order_id>`
–í—ñ–¥—Ö–∏–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

**–ü—Ä–∏–∫–ª–∞–¥:** `order:reject:1`

**–ï—Ñ–µ–∫—Ç:**
- –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ —Å—Ç–∞—Ç—É—Å—ñ `offered`
- –ú–æ–∂–µ –±—É—Ç–∏ –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–æ —ñ–Ω—à–æ–º—É –≤–æ–¥—ñ—é

---

#### `order:start:<order_id>`
–ü–æ—á–∞—Ç–∏ –ø–æ—ó–∑–¥–∫—É

**–ü—Ä–∏–∫–ª–∞–¥:** `order:start:1`

**–ï—Ñ–µ–∫—Ç:**
- –°—Ç–∞—Ç—É—Å ‚Üí `in_progress`
- –í–æ–¥—ñ–π –≤ —Å—Ç–∞—Ç—É—Å—ñ "–í –¥–æ—Ä–æ–∑—ñ"
- –ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º—É—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

---

#### `order:complete:<order_id>`
–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –ø–æ—ó–∑–¥–∫—É

**–ü—Ä–∏–∫–ª–∞–¥:** `order:complete:1`

**–ï—Ñ–µ–∫—Ç:**
- –°—Ç–∞—Ç—É—Å ‚Üí `completed`
- –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ —Ç–∞ –∫–æ–º—ñ—Å—ñ—ó
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É –ø–ª–∞—Ç–µ–∂—É
- –ö–ª—ñ—î–Ω—Ç –º–æ–∂–µ –æ—Ü—ñ–Ω–∏—Ç–∏ –≤–æ–¥—ñ—è

---

### –î–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤ (—Ä–µ–π—Ç–∏–Ω–≥–∏):

#### `rate:driver:<driver_tg_id>:<rating>:<order_id>`
–û—Ü—ñ–Ω–∏—Ç–∏ –≤–æ–¥—ñ—è

**–ü—Ä–∏–∫–ª–∞–¥:** `rate:driver:123456789:5:1`

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `driver_tg_id` - Telegram ID –≤–æ–¥—ñ—è
- `rating` - –û—Ü—ñ–Ω–∫–∞ (1-5)
- `order_id` - ID –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

**–ï—Ñ–µ–∫—Ç:**
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É —Ä–µ–π—Ç–∏–Ω–≥—É
- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤–æ–¥—ñ—è

---

### –î–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

#### `drv:approve:<driver_id>`
–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–æ–¥—ñ—è

**–ü—Ä–∏–∫–ª–∞–¥:** `drv:approve:1`

**–ï—Ñ–µ–∫—Ç:**
- –°—Ç–∞—Ç—É—Å –≤–æ–¥—ñ—è ‚Üí `approved`
- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤–æ–¥—ñ—è

---

#### `drv:reject:<driver_id>`
–í—ñ–¥—Ö–∏–ª–∏—Ç–∏ –∑–∞—è–≤–∫—É

**–ü—Ä–∏–∫–ª–∞–¥:** `drv:reject:1`

**–ï—Ñ–µ–∫—Ç:**
- –°—Ç–∞—Ç—É—Å –≤–æ–¥—ñ—è ‚Üí `rejected`
- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤–æ–¥—ñ—è

---

#### `tariff:edit`
–ü–æ—á–∞—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞—Ä–∏—Ñ—ñ–≤

**–ï—Ñ–µ–∫—Ç:**
- –ó–∞–ø—É—Å–∫ –¥—ñ–∞–ª–æ–≥—É –∑–º—ñ–Ω–∏ —Ç–∞—Ä–∏—Ñ—ñ–≤

---

#### `commission:paid`
–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å–ø–ª–∞—Ç–∏ –∫–æ–º—ñ—Å—ñ—ó

**–ï—Ñ–µ–∫—Ç:**
- –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–ª–∞—Ç–µ–∂—ñ–≤ –≤–æ–¥—ñ—è —è–∫ —Å–ø–ª–∞—á–µ–Ω–∏—Ö
- `commission_paid` ‚Üí `true`

---

## üóÑÔ∏è API –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### Users

```python
async def upsert_user(db_path: str, user: User) -> None
```
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–±–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```python
async def get_user_by_id(db_path: str, user_id: int) -> Optional[User]
```
–û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ ID

---

### Drivers

```python
async def create_driver_application(db_path: str, driver: Driver) -> int
```
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—è–≤–∫–∏ –≤–æ–¥—ñ—è

```python
async def update_driver_status(db_path: str, driver_id: int, status: str) -> None
```
–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –≤–æ–¥—ñ—è

```python
async def set_driver_online(db_path: str, tg_user_id: int, online: bool) -> None
```
–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω

```python
async def update_driver_location(db_path: str, tg_user_id: int, lat: float, lon: float) -> None
```
–û–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –≤–æ–¥—ñ—è

```python
async def fetch_online_drivers(db_path: str, limit: int = 50) -> List[Driver]
```
–û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–Ω–ª–∞–π–Ω-–≤–æ–¥—ñ—ó–≤

```python
async def get_driver_by_tg_user_id(db_path: str, tg_user_id: int) -> Optional[Driver]
```
–û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–æ–¥—ñ—è –∑–∞ Telegram ID

---

### Orders

```python
async def insert_order(db_path: str, order: Order) -> int
```
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

```python
async def get_order_by_id(db_path: str, order_id: int) -> Optional[Order]
```
–û—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞ ID

```python
async def offer_order_to_driver(db_path: str, order_id: int, driver_id: int) -> bool
```
–ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤–æ–¥—ñ—é

```python
async def accept_order(db_path: str, order_id: int, driver_id: int) -> bool
```
–ü—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

```python
async def start_order(db_path: str, order_id: int, driver_id: int) -> bool
```
–ü–æ—á–∞—Ç–∏ –ø–æ—ó–∑–¥–∫—É

```python
async def complete_order(db_path: str, order_id: int, driver_id: int, fare_amount: float, distance_m: int, duration_s: int, commission: float) -> bool
```
–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –ø–æ—ó–∑–¥–∫—É

```python
async def fetch_recent_orders(db_path: str, limit: int = 10) -> List[Order]
```
–û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å

```python
async def get_user_order_history(db_path: str, user_id: int, limit: int = 10) -> List[Order]
```
–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–ª—ñ—î–Ω—Ç–∞

```python
async def get_driver_order_history(db_path: str, driver_tg_id: int, limit: int = 10) -> List[Order]
```
–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –≤–æ–¥—ñ—è

---

### Tariffs

```python
async def insert_tariff(db_path: str, t: Tariff) -> int
```
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ç–∞—Ä–∏—Ñ—É

```python
async def get_latest_tariff(db_path: str) -> Optional[Tariff]
```
–û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —Ç–∞—Ä–∏—Ñ—É

---

### Ratings

```python
async def insert_rating(db_path: str, rating: Rating) -> int
```
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ—Ü—ñ–Ω–∫–∏

```python
async def get_driver_average_rating(db_path: str, driver_user_id: int) -> Optional[float]
```
–°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥ –≤–æ–¥—ñ—è

---

### Payments

```python
async def insert_payment(db_path: str, payment: Payment) -> int
```
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É –ø–ª–∞—Ç–µ–∂—É

```python
async def mark_commission_paid(db_path: str, driver_tg_id: int) -> None
```
–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –∫–æ–º—ñ—Å—ñ—é —è–∫ —Å–ø–ª–∞—á–µ–Ω—É

```python
async def get_driver_earnings_today(db_path: str, driver_tg_id: int) -> Tuple[float, float]
```
–ó–∞—Ä–æ–±—ñ—Ç–æ–∫ –≤–æ–¥—ñ—è –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ (total, commission)

```python
async def get_driver_unpaid_commission(db_path: str, driver_tg_id: int) -> float
```
–ù–µ—Å–ø–ª–∞—á–µ–Ω–∞ –∫–æ–º—ñ—Å—ñ—è –≤–æ–¥—ñ—è

---

## üó∫Ô∏è Google Maps API

### Distance Matrix

```python
async def get_distance_and_duration(
    api_key: str,
    origin_lat: float,
    origin_lon: float,
    dest_lat: float,
    dest_lon: float
) -> Optional[Tuple[int, int]]
```

**–ü–æ–≤–µ—Ä—Ç–∞—î:** `(distance_meters, duration_seconds)`

---

### Geocoding

```python
async def geocode_address(api_key: str, address: str) -> Optional[Tuple[float, float]]
```

**–ü–æ–≤–µ—Ä—Ç–∞—î:** `(latitude, longitude)`

---

### Static Map

```python
def generate_static_map_url(
    api_key: str,
    origin_lat: float,
    origin_lon: float,
    dest_lat: float,
    dest_lon: float,
    width: int = 600,
    height: int = 400
) -> str
```

**–ü–æ–≤–µ—Ä—Ç–∞—î:** URL —Å—Ç–∞—Ç–∏—á–Ω–æ—ó –∫–∞—Ä—Ç–∏

---

## üéØ –£—Ç–∏–ª—ñ—Ç–∏

### Matching

```python
async def find_nearest_driver(
    db_path: str,
    pickup_lat: float,
    pickup_lon: float
) -> Optional[Driver]
```
–ó–Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ –æ–Ω–ª–∞–π–Ω-–≤–æ–¥—ñ—è

```python
def calculate_distance(lat1: float, lon1: float, lat2: float, lon2: float) -> float
```
–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤—ñ–¥—Å—Ç–∞–Ω—ñ –∑–∞ Haversine (–º–µ—Ç—Ä–∏)

```python
def parse_geo_coordinates(address: str) -> Optional[Tuple[float, float]]
```
–ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç—É `geo:lat,lon`

---

### Scheduler

```python
async def start_scheduler(bot: Bot, db_path: str) -> None
```
–ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞ –∑–∞–≤–¥–∞–Ω—å

```python
async def commission_reminder_task(bot: Bot, db_path: str) -> None
```
–©–æ–¥–µ–Ω–Ω–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –æ 20:00 UTC

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

### Order —Å—Ç–∞—Ç—É—Å–∏
- `pending` - –°—Ç–≤–æ—Ä–µ–Ω–æ
- `offered` - –ó–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–æ –≤–æ–¥—ñ—é
- `accepted` - –ü—Ä–∏–π–Ω—è—Ç–æ –≤–æ–¥—ñ—î–º
- `in_progress` - –í –ø—Ä–æ—Ü–µ—Å—ñ
- `completed` - –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- `cancelled` - –°–∫–∞—Å–æ–≤–∞–Ω–æ

### Driver —Å—Ç–∞—Ç—É—Å–∏
- `pending` - –ù–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—ó
- `approved` - –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ
- `rejected` - –í—ñ–¥—Ö–∏–ª–µ–Ω–æ

### User roles
- `client` - –ö–ª—ñ—î–Ω—Ç
- `driver` - –í–æ–¥—ñ–π (–æ–∫—Ä–µ–º–æ –≤ —Ç–∞–±–ª–∏—Ü—ñ drivers)

---

## üîê –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É

| –ö–æ–º–∞–Ω–¥–∞ | –ö–ª—ñ—î–Ω—Ç | –í–æ–¥—ñ–π | –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä |
|---------|--------|-------|---------------|
| `/start` | ‚úÖ | ‚úÖ | ‚úÖ |
| `/help` | ‚úÖ | ‚úÖ | ‚úÖ |
| `/client` | ‚úÖ | ‚úÖ | ‚úÖ |
| `/order` | ‚úÖ | ‚úÖ | ‚úÖ |
| `/my_rating` | ‚úÖ | ‚úÖ | ‚úÖ |
| `/driver` | ‚ùå | ‚úÖ | ‚úÖ |
| `/register_driver` | ‚úÖ | ‚úÖ | ‚úÖ |
| `/my_driver_status` | ‚ùå | ‚úÖ | ‚úÖ |
| `/admin` | ‚ùå | ‚ùå | ‚úÖ |
| `/orders` | ‚ùå | ‚ùå | ‚úÖ |
| `/pending_drivers` | ‚ùå | ‚ùå | ‚úÖ |
| `/approve_driver` | ‚ùå | ‚ùå | ‚úÖ |
| `/reject_driver` | ‚ùå | ‚ùå | ‚úÖ |

---

**–í–µ—Ä—Å—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó: 1.0.0**
