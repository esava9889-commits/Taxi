# ‚≠ê –°–∏—Å—Ç–µ–º–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å - –ü–†–ê–í–ò–õ–¨–ù–ê –õ–û–ì–Ü–ö–ê

**–î–∞—Ç–∞:** 2025-10-27  
**–ê–≤—Ç–æ—Ä:** AI Assistant

## üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è

–ê–¥–º—ñ–Ω —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è –º–æ–∂–µ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ —Ç—É–º–±–ª–µ—Ä "–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç"** –ø—ñ–¥ –∫–æ–∂–Ω–∏–º –≤–æ–¥—ñ—î–º.

### –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏:

1. ‚úÖ –ê–¥–º—ñ–Ω –≤–º–∏–∫–∞—î **—Ç—É–º–±–ª–µ—Ä "‚≠ê –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç"** –ø—ñ–¥ –æ–¥–Ω–∏–º –∞–±–æ –¥–µ–∫—ñ–ª—å–∫–æ–º–∞ –≤–æ–¥—ñ—è–º–∏
2. ‚úÖ **–í–°–Ü –Ω–∞—Å—Ç—É–ø–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è** –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è **–¢–Ü–õ–¨–ö–ò —Ü–∏–º –≤–æ–¥—ñ—è–º** (–∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º)
3. ‚úÖ –í–æ–¥—ñ—ó –±–∞—á–∞—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ **–æ—Å–æ–±–∏—Å—Ç–æ–º—É —á–∞—Ç—ñ** –∑ –ø–æ–∑–Ω–∞—á–∫–æ—é **"‚≠ê‚≠ê‚≠ê –ü–†–Ü–û–†–ò–¢–ï–¢–ù–ï ‚≠ê‚≠ê‚≠ê"**
4. ‚úÖ –í–æ–¥—ñ–π –º–æ–∂–µ **–ø—Ä–∏–π–Ω—è—Ç–∏** (—Ö—Ç–æ —à–≤–∏–¥—à–µ - —Ç–æ–π –æ—Ç—Ä–∏–º—É—î) –∞–±–æ **–≤—ñ–¥—Ö–∏–ª–∏—Ç–∏**
5. ‚úÖ –ü—Ä–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—ñ:
   - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è —É —Ü—å–æ–≥–æ –≤–æ–¥—ñ—è
   - **–Ü–Ω—à—ñ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤–æ–¥—ñ—ó** –≤—Å–µ —â–µ –±–∞—á–∞—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
   - –Ø–∫—â–æ **–í–°–Ü** –≤—ñ–¥—Ö–∏–ª–∏–ª–∏ ‚Üí –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –π–¥–µ –≤ **–≥—Ä—É–ø—É –ë–ï–ó –ø–æ–∑–Ω–∞—á–∫–∏** –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ
6. ‚úÖ –Ø–∫—â–æ **—Ç–∞–π–º–∞—É—Ç 60 —Å–µ–∫—É–Ω–¥** —ñ –Ω—ñ—Ö—Ç–æ –Ω–µ –ø—Ä–∏–π–Ω—è–≤ ‚Üí –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –π–¥–µ –≤ **–≥—Ä—É–ø—É –ë–ï–ó –ø–æ–∑–Ω–∞—á–∫–∏**

## üîß –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### 1. –¢—É–º–±–ª–µ—Ä –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ

**–§–∞–π–ª:** `app/handlers/admin.py`

```python
# –†—è–¥–æ–∫ 1682-1688
elif action == "priority_toggle":
    # –ü–µ—Ä–µ–º–∏–∫–∞—á –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—ñ –≤–æ–¥—ñ—è (0/1)
    new_priority = 0 if (driver.priority or 0) > 0 else 1
    async with db_manager.connect(config.database_path) as db:
        await db.execute("UPDATE drivers SET priority = ? WHERE id = ?", (new_priority, driver_id))
        await db.commit()
```

**–ó–Ω–∞—á–µ–Ω–Ω—è:**
- `priority = 0` - –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤–∏–º–∫–Ω–µ–Ω–æ ‚ùå
- `priority = 1` (–∞–±–æ > 0) - –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —É–≤—ñ–º–∫–Ω–µ–Ω–æ ‚úÖ

### 2. –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å –í–°–Ü–ú –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–º –≤–æ–¥—ñ—è–º

**–§–∞–π–ª:** `app/utils/priority_order_manager.py`

**–ë—É–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```python
# –í–∑—è—Ç–∏ —Ç–æ–ø-5 –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤
top_drivers = priority_drivers[:5]

for driver in top_drivers:
    await bot.send_message(...)
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```python
# –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –í–°–Ü–ú –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–º –≤–æ–¥—ñ—è–º (–∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º)
for driver in priority_drivers:  # –í—Å—ñ, –Ω–µ —Ç–æ–ø-5!
    await bot.send_message(
        chat_id=driver.tg_user_id,
        text=message_text,
        reply_markup=kb,  # [‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏] [‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏]
        parse_mode="HTML"
    )
```

### 3. –õ–æ–≥—ñ–∫–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è

**–§–∞–π–ª:** `app/handlers/driver_panel.py` (—Ä—è–¥–∫–∏ 1546-1633)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```python
# 1. –í–æ–¥—ñ–π –Ω–∞—Ç–∏—Å–∫–∞—î "–í—ñ–¥—Ö–∏–ª–∏—Ç–∏"
await add_rejected_driver(config.database_path, order_id, driver.id)
await call.message.delete()  # –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —Ü—å–æ–≥–æ –≤–æ–¥—ñ—è

# 2. –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ—Ö –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤ –¥–ª—è —Ü—å–æ–≥–æ –º—ñ—Å—Ç–∞/–∫–ª–∞—Å—É –∞–≤—Ç–æ
all_drivers = await get_drivers_by_city(config.database_path, client_city)
priority_drivers = [d for d in all_drivers if d.online and d.priority > 0]
priority_drivers = [d for d in priority_drivers if d.car_class == order.car_class]

# 3. –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ç–∏—Ö, —Ö—Ç–æ –≤–∂–µ –≤—ñ–¥—Ö–∏–ª–∏–≤
rejected_driver_ids = await get_rejected_drivers_for_order(config.database_path, order_id)

# 4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –í–°–Ü –≤—ñ–¥—Ö–∏–ª–∏–ª–∏
all_rejected = len(rejected_driver_ids) >= len(priority_drivers)

if all_rejected:
    # –í–°–Ü –≤—ñ–¥—Ö–∏–ª–∏–ª–∏ ‚Üí –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ –≥—Ä—É–ø—É –ë–ï–ó –ø–æ–∑–Ω–∞—á–∫–∏
    await _send_to_group(bot, order_id, city_group_id, order_details)
else:
    # –©–µ —î —Ö—Ç–æ—Å—å ‚Üí –≤–æ–Ω–∏ –≤—Å–µ —â–µ –±–∞—á–∞—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    remaining = len(priority_drivers) - len(rejected_driver_ids)
    logger.info(f"‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id} –≤—Å–µ —â–µ –¥–æ—Å—Ç—É–ø–Ω–µ –¥–ª—è {remaining} –≤–æ–¥—ñ—ó–≤")
```

### 4. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤

**–í –æ—Å–æ–±–∏—Å—Ç–æ–º—É —á–∞—Ç—ñ –≤–æ–¥—ñ—è:**
```
‚≠ê‚≠ê‚≠ê –ü–†–Ü–û–†–ò–¢–ï–¢–ù–ï –ó–ê–ú–û–í–õ–ï–ù–ù–Ø #123 ‚≠ê‚≠ê‚≠ê

üéØ –¶–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω–µ —Ç—ñ–ª—å–∫–∏ –≤–æ–¥—ñ—è–º –∑ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º!
–ü—Ä–∏–π–º—ñ—Ç—å –∞–±–æ –≤—ñ–¥—Ö–∏–ª—ñ—Ç—å –ø—Ä–æ—Ç—è–≥–æ–º 60 —Å–µ–∫—É–Ω–¥

üë§ –ö–ª—ñ—î–Ω—Ç: –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ
üì± –¢–µ–ª–µ—Ñ–æ–Ω: +380*******45

üìç –ó–≤—ñ–¥–∫–∏: –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1
üìç –ö—É–¥–∏: –≤—É–ª. –°–∞–∫—Å–∞–≥–∞–Ω—Å—å–∫–æ–≥–æ, 25

üìè –í—ñ–¥—Å—Ç–∞–Ω—å: 3.5 –∫–º (~7 —Ö–≤)
üöó –ö–ª–∞—Å –∞–≤—Ç–æ: –ï–∫–æ–Ω–æ–º
üí∞ –í–ê–†–¢–Ü–°–¢–¨: 85 –≥—Ä–Ω üí∞

üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä: –ù–µ–º–∞—î

‚úÖ –ü—Ä–∏–π–º—ñ—Ç—å - –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –±—É–¥–µ –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–æ –∑–∞ –≤–∞–º–∏
‚ùå –í—ñ–¥—Ö–∏–ª—ñ—Ç—å - —ñ–Ω—à—ñ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤–æ–¥—ñ—ó –≤—Å–µ —â–µ –±–∞—á–∞—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

‚è∞ –Ø–∫—â–æ –≤—Å—ñ –≤—ñ–¥—Ö–∏–ª—è—Ç—å –∞–±–æ –ø—Ä–æ–π–¥–µ 60 —Å–µ–∫—É–Ω–¥ - –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑'—è–≤–∏—Ç—å—Å—è –≤ –∑–∞–≥–∞–ª—å–Ω—ñ–π –≥—Ä—É–ø—ñ.
```

**–ö–Ω–æ–ø–∫–∏:**
- [‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è]
- [‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è]

**–í –≥—Ä—É–ø—ñ (–ø—ñ—Å–ª—è –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –í–°–Ü–ú–ê –∞–±–æ —Ç–∞–π–º–∞—É—Ç—É):**
```
üöñ –ó–ê–ú–û–í–õ–ï–ù–ù–Ø #123

üë§ –ö–ª—ñ—î–Ω—Ç: –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ
üì± –¢–µ–ª–µ—Ñ–æ–Ω: +380*******45

üìç –ó–≤—ñ–¥–∫–∏: –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1
üìç –ö—É–¥–∏: –≤—É–ª. –°–∞–∫—Å–∞–≥–∞–Ω—Å—å–∫–æ–≥–æ, 25

üìè –í—ñ–¥—Å—Ç–∞–Ω—å: 3.5 –∫–º (~7 —Ö–≤)
üöó –ö–ª–∞—Å –∞–≤—Ç–æ: –ï–∫–æ–Ω–æ–º
üí∞ –í–ê–†–¢–Ü–°–¢–¨: 85 –≥—Ä–Ω üí∞

üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä: –ù–µ–º–∞—î
```

‚ö†Ô∏è **–ë–ï–ó –ø–æ–∑–Ω–∞—á–∫–∏ "–ü–†–Ü–û–†–ò–¢–ï–¢–ù–ï"** - –∑–≤–∏—á–∞–π–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!

## üìä –ü—Ä–∏–∫–ª–∞–¥–∏ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –û–¥–∏–Ω –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–π –≤–æ–¥—ñ–π –ø—Ä–∏–π–º–∞—î

1. –ê–¥–º—ñ–Ω —É–≤—ñ–º–∫–Ω—É–≤ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç **–í–æ–¥—ñ—é –ê**
2. –ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. **–í–æ–¥—ñ–π –ê** –æ—Ç—Ä–∏–º—É—î –≤ —á–∞—Ç: "‚≠ê‚≠ê‚≠ê –ü–†–Ü–û–†–ò–¢–ï–¢–ù–ï –ó–ê–ú–û–í–õ–ï–ù–ù–Ø #123 ‚≠ê‚≠ê‚≠ê"
4. **–í–æ–¥—ñ–π –ê** –Ω–∞—Ç–∏—Å–∫–∞—î "‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏"
5. ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–∫—Ä—ñ–ø–ª—é—î—Ç—å—Å—è –∑–∞ **–í–æ–¥—ñ—î–º –ê**

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –¢—Ä–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤–æ–¥—ñ—ó, –æ–¥–∏–Ω –ø—Ä–∏–π–º–∞—î

1. –ê–¥–º—ñ–Ω —É–≤—ñ–º–∫–Ω—É–≤ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç **–í–æ–¥—ñ—è–º –ê, –ë, –í**
2. –ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. **–í—Å—ñ —Ç—Ä–æ—î** –æ—Ç—Ä–∏–º—É—é—Ç—å: "‚≠ê‚≠ê‚≠ê –ü–†–Ü–û–†–ò–¢–ï–¢–ù–ï –ó–ê–ú–û–í–õ–ï–ù–ù–Ø #123 ‚≠ê‚≠ê‚≠ê"
4. **–í–æ–¥—ñ–π –ë** —à–≤–∏–¥—à–µ –≤—Å—ñ—Ö –Ω–∞—Ç–∏—Å–∫–∞—î "‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏"
5. ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–∫—Ä—ñ–ø–ª—é—î—Ç—å—Å—è –∑–∞ **–í–æ–¥—ñ—î–º –ë**
6. –£ **–í–æ–¥—ñ—ó–≤ –ê —Ç–∞ –í** –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–Ω–∏–∫–∞—î (–≤–∂–µ –ø—Ä–∏–π–Ω—è—Ç–æ)

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –î–≤–∞ –≤–æ–¥—ñ—ó –≤—ñ–¥—Ö–∏–ª—è—é—Ç—å, —Ç—Ä–µ—Ç—ñ–π –ø—Ä–∏–π–º–∞—î

1. –ê–¥–º—ñ–Ω —É–≤—ñ–º–∫–Ω—É–≤ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç **–í–æ–¥—ñ—è–º –ê, –ë, –í**
2. –ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. **–í—Å—ñ —Ç—Ä–æ—î** –æ—Ç—Ä–∏–º—É—é—Ç—å –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
4. **–í–æ–¥—ñ–π –ê** –Ω–∞—Ç–∏—Å–∫–∞—î "‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏"
   - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è —É **–í–æ–¥—ñ—è –ê**
   - **–í–æ–¥—ñ—ó –ë —Ç–∞ –í** –≤—Å–µ —â–µ –±–∞—á–∞—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
   - –õ–æ–≥–∏: "‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #123 –≤—Å–µ —â–µ –¥–æ—Å—Ç—É–ø–Ω–µ –¥–ª—è 2 –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤"
5. **–í–æ–¥—ñ–π –ë** –Ω–∞—Ç–∏—Å–∫–∞—î "‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏"
   - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è —É **–í–æ–¥—ñ—è –ë**
   - **–í–æ–¥—ñ–π –í** –≤—Å–µ —â–µ –±–∞—á–∏—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
   - –õ–æ–≥–∏: "‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #123 –≤—Å–µ —â–µ –¥–æ—Å—Ç—É–ø–Ω–µ –¥–ª—è 1 –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤"
6. **–í–æ–¥—ñ–π –í** –Ω–∞—Ç–∏—Å–∫–∞—î "‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏"
7. ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–∫—Ä—ñ–ø–ª—é—î—Ç—å—Å—è –∑–∞ **–í–æ–¥—ñ—î–º –í**

### –°—Ü–µ–Ω–∞—Ä—ñ–π 4: –í–°–Ü –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤—ñ–¥—Ö–∏–ª—è—é—Ç—å

1. –ê–¥–º—ñ–Ω —É–≤—ñ–º–∫–Ω—É–≤ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç **–í–æ–¥—ñ—è–º –ê —Ç–∞ –ë**
2. –ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. **–û–±–∏–¥–≤–∞** –æ—Ç—Ä–∏–º—É—é—Ç—å –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
4. **–í–æ–¥—ñ–π –ê** –Ω–∞—Ç–∏—Å–∫–∞—î "‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏"
   - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è —É **–í–æ–¥—ñ—è –ê**
   - **–í–æ–¥—ñ–π –ë** –≤—Å–µ —â–µ –±–∞—á–∏—Ç—å
5. **–í–æ–¥—ñ–π –ë** –Ω–∞—Ç–∏—Å–∫–∞—î "‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏"
   - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è —É **–í–æ–¥—ñ—è –ë**
   - –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î: 2 –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤, 2 –≤—ñ–¥—Ö–∏–ª–∏–ª–∏ ‚Üí –í–°–Ü –≤—ñ–¥—Ö–∏–ª–∏–ª–∏!
   - –õ–æ–≥–∏: "üì¢ –í–°–Ü –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤–æ–¥—ñ—ó –≤—ñ–¥—Ö–∏–ª–∏–ª–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #123, –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é –≤ –≥—Ä—É–ø—É"
6. üì¢ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ **–≥—Ä—É–ø—ñ –ë–ï–ó –ø–æ–∑–Ω–∞—á–∫–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ**
7. –ë—É–¥—å-—è–∫–∏–π –≤–æ–¥—ñ–π –∑ –≥—Ä—É–ø–∏ –º–æ–∂–µ –ø—Ä–∏–π–Ω—è—Ç–∏

### –°—Ü–µ–Ω–∞—Ä—ñ–π 5: –¢–∞–π–º–∞—É—Ç 60 —Å–µ–∫—É–Ω–¥

1. –ê–¥–º—ñ–Ω —É–≤—ñ–º–∫–Ω—É–≤ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç **–í–æ–¥—ñ—è–º –ê —Ç–∞ –ë**
2. –ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. **–û–±–∏–¥–≤–∞** –æ—Ç—Ä–∏–º—É—é—Ç—å –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
4. **–ù—ñ—Ö—Ç–æ –Ω–µ –Ω–∞—Ç–∏—Å–∫–∞—î** 60 —Å–µ–∫—É–Ω–¥ ‚è∞
5. –°–ø—Ä–∞—Ü—å–æ–≤—É—î —Ç–∞–π–º–µ—Ä
6. üì¢ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ **–≥—Ä—É–ø—ñ –ë–ï–ó –ø–æ–∑–Ω–∞—á–∫–∏**
7. –ë—É–¥—å-—è–∫–∏–π –≤–æ–¥—ñ–π –∑ –≥—Ä—É–ø–∏ –º–æ–∂–µ –ø—Ä–∏–π–Ω—è—Ç–∏

### –°—Ü–µ–Ω–∞—Ä—ñ–π 6: –ù–µ–º–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤

1. –£ –≤—Å—ñ—Ö –≤–æ–¥—ñ—ó–≤ `priority = 0` (–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤–∏–º–∫–Ω–µ–Ω–æ)
2. –ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î: –Ω–µ–º–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤
4. üì¢ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è **–æ–¥—Ä–∞–∑—É** –π–¥–µ –≤ **–≥—Ä—É–ø—É**
5. –ó–≤–∏—á–∞–π–Ω–∞ –ª–æ–≥—ñ–∫–∞ - –±—É–¥—å-—è–∫–∏–π –≤–æ–¥—ñ–π –º–æ–∂–µ –ø—Ä–∏–π–Ω—è—Ç–∏

## üé® –í—ñ–∑—É–∞–ª—å–Ω–∞ —Å—Ö–µ–º–∞

```
–ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
         ‚Üì
–Ñ –≤–æ–¥—ñ—ó –∑ priority > 0?
    ‚Üô         ‚Üò
  –¢–ê–ö         –ù–Ü
   ‚Üì           ‚Üì
–ù–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è  –í –≥—Ä—É–ø—É
–í–°–Ü–ú –∑ priority  –æ–¥—Ä–∞–∑—É
   ‚Üì
–í–æ–¥—ñ—ó –±–∞—á–∞—Ç—å:
‚≠ê‚≠ê‚≠ê –ü–†–Ü–û–†–ò–¢–ï–¢–ù–ï ‚≠ê‚≠ê‚≠ê
[‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏] [‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏]
   ‚Üì
   ‚îú‚îÄ‚Üí –•–¢–û–°–¨ –ü–†–ò–ô–ú–ê–Ñ ‚Üí –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–æ
   ‚îÇ
   ‚îú‚îÄ‚Üí –•–¢–û–°–¨ –í–Ü–î–•–ò–õ–Ø–Ñ ‚Üí 
   ‚îÇ      ‚Üì
   ‚îÇ   –£—Å—ñ –≤—ñ–¥—Ö–∏–ª–∏–ª–∏?
   ‚îÇ    ‚Üô         ‚Üò
   ‚îÇ  –¢–ê–ö         –ù–Ü
   ‚îÇ   ‚Üì           ‚Üì
   ‚îÇ  –í –≥—Ä—É–ø—É    –Ü–Ω—à—ñ –≤—Å–µ —â–µ
   ‚îÇ  (–ë–ï–ó ‚≠ê)    –±–∞—á–∞—Ç—å
   ‚îÇ
   ‚îî‚îÄ‚Üí –¢–ê–ô–ú–ê–£–¢ 60—Å ‚Üí –í –≥—Ä—É–ø—É (–ë–ï–ó ‚≠ê)
```

## üîí –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏

### ‚úÖ –©–æ –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –≤–æ–¥—ñ—ó–≤:**
   - –¢—ñ–ª—å–∫–∏ –æ–Ω–ª–∞–π–Ω –≤–æ–¥—ñ—ó (`driver.online == True`)
   - –¢—ñ–ª—å–∫–∏ –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º (`driver.priority > 0`)
   - –¢—ñ–ª—å–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—É –∞–≤—Ç–æ (`driver.car_class == order.car_class`)
   - –¢—ñ–ª—å–∫–∏ –∑ —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ –º—ñ—Å—Ç–∞ (`driver.city == client_city`)

2. **–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è:**
   - –í–æ–¥—ñ–π –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Ö–∏–ª–µ–Ω–∏—Ö (`rejected_offers` —Ç–∞–±–ª–∏—Ü—è)
   - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —É —Ü—å–æ–≥–æ –≤–æ–¥—ñ—è
   - –Ü–Ω—à—ñ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤–æ–¥—ñ—ó –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –±–∞—á–∏—Ç–∏
   - –ö–æ–ª–∏ –í–°–Ü –≤—ñ–¥—Ö–∏–ª–∏–ª–∏ ‚Üí —Ç–æ–¥—ñ –≤ –≥—Ä—É–ø—É

3. **–ë–µ–∑–ø–µ–∫–∞:**
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `order.status == "pending"` (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —â–µ –Ω–µ –ø—Ä–∏–π–Ω—è—Ç–æ)
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `not order.group_message_id` (—â–µ –Ω–µ –≤ –≥—Ä—É–ø—ñ)
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ –≤–æ–¥—ñ–π —ñ—Å–Ω—É—î —Ç–∞ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π

4. **–õ–æ–≥—É–≤–∞–Ω–Ω—è:**
   ```python
   logger.info(f"‚≠ê –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id}: –∑–Ω–∞–π–¥–µ–Ω–æ {len(priority_drivers)} –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤")
   logger.info(f"üì® –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id} –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–æ–º—É –≤–æ–¥—ñ—é {driver.full_name}")
   logger.info(f"‚ùå –í–æ–¥—ñ–π {driver.full_name} –≤—ñ–¥—Ö–∏–ª–∏–≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id}")
   logger.info(f"üìä –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id}: –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤={len(priority_drivers)}, –≤—ñ–¥—Ö–∏–ª–∏–ª–∏={len(rejected_driver_ids)}")
   logger.info(f"‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id} –≤—Å–µ —â–µ –¥–æ—Å—Ç—É–ø–Ω–µ –¥–ª—è {remaining} –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤")
   logger.info(f"üì¢ –í–°–Ü –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤–æ–¥—ñ—ó –≤—ñ–¥—Ö–∏–ª–∏–ª–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id}, –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é –≤ –≥—Ä—É–ø—É")
   ```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç 1: –û–¥–∏–Ω –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–π –≤–æ–¥—ñ–π
1. ‚úÖ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –æ–¥–Ω–æ–º—É –≤–æ–¥—ñ—é
2. ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤–æ–Ω–æ –ø—Ä–∏–π—à–ª–æ —Ç—ñ–ª—å–∫–∏ –π–æ–º—É
4. ‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏ ‚Üí –º–∞—î –∑–∞–∫—Ä—ñ–ø–∏—Ç–∏—Å—å

### –¢–µ—Å—Ç 2: –¢—Ä–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ –≤–æ–¥—ñ—ó
1. ‚úÖ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —Ç—Ä—å–æ–º –≤–æ–¥—ñ—è–º
2. ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å—ñ —Ç—Ä–æ—î –æ—Ç—Ä–∏–º–∞–ª–∏
4. ‚úÖ –û–¥–∏–Ω –ø—Ä–∏–π–º–∞—î ‚Üí —ñ–Ω—à—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–Ω–∏–∫–∞—é—Ç—å

### –¢–µ—Å—Ç 3: –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –æ–¥–Ω–∏–º, –ø—Ä–∏–π–Ω—è—Ç—Ç—è —ñ–Ω—à–∏–º
1. ‚úÖ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –¥–≤–æ–º –≤–æ–¥—ñ—è–º
2. ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. ‚úÖ –ü–µ—Ä—à–∏–π –≤—ñ–¥—Ö–∏–ª—è—î ‚Üí –π–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–Ω–∏–∫–∞—î
4. ‚úÖ –î—Ä—É–≥–∏–π –≤—Å–µ —â–µ –±–∞—á–∏—Ç—å
5. ‚úÖ –î—Ä—É–≥–∏–π –ø—Ä–∏–π–º–∞—î ‚Üí –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–∫—Ä—ñ–ø–ª—é—î—Ç—å—Å—è

### –¢–µ—Å—Ç 4: –í–°–Ü –≤—ñ–¥—Ö–∏–ª—è—é—Ç—å
1. ‚úÖ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –¥–≤–æ–º –≤–æ–¥—ñ—è–º
2. ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. ‚úÖ –û–±–∏–¥–≤–∞ –≤—ñ–¥—Ö–∏–ª—è—é—Ç—å
4. ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ –≥—Ä—É–ø—ñ –ë–ï–ó –ø–æ–∑–Ω–∞—á–∫–∏ ‚≠ê

### –¢–µ—Å—Ç 5: –¢–∞–π–º–∞—É—Ç
1. ‚úÖ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤–æ–¥—ñ—é
2. ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. ‚úÖ –ß–µ–∫–∞—Ç–∏ 60 —Å–µ–∫—É–Ω–¥
4. ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—å –≤ –≥—Ä—É–ø—ñ

### –¢–µ—Å—Ç 6: –†—ñ–∑–Ω—ñ –∫–ª–∞—Å–∏ –∞–≤—Ç–æ
1. ‚úÖ –í–æ–¥—ñ–π –ê (–ï–∫–æ–Ω–æ–º, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç = 1)
2. ‚úÖ –í–æ–¥—ñ–π –ë (–ö–æ–º—Ñ–æ—Ä—Ç, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç = 1)
3. ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫–ª–∞—Å "–ï–∫–æ–Ω–æ–º"
4. ‚úÖ –ú–∞—î –ø—Ä–∏–π—Ç–∏ —Ç—ñ–ª—å–∫–∏ –í–æ–¥—ñ—é –ê

## üìù –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏

1. ‚úÖ `app/utils/priority_order_manager.py` - –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –í–°–Ü–ú –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–º (–Ω–µ —Ç–æ–ø-5)
2. ‚úÖ `app/handlers/driver_panel.py` - –ª–æ–≥—ñ–∫–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é "–≤—Å—ñ –≤—ñ–¥—Ö–∏–ª–∏–ª–∏"

## üöÄ –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å—ñ –∑–º—ñ–Ω–∏ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ  
**Linter:** ‚úÖ –ë–µ–∑ –ø–æ–º–∏–ª–æ–∫  
**Backward compatibility:** ‚úÖ –¢–∞–∫  
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ deployment:** ‚úÖ –¢–∞–∫

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-10-27
