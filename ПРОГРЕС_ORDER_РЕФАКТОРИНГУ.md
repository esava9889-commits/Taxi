# –ü–†–û–ì–†–ï–°: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ order.py

**–§–∞–π–ª:** `app/handlers/order.py` (1125 —Ä—è–¥–∫—ñ–≤)

---

## üìä –°–¢–†–£–ö–¢–£–†–ê order.py

### –ö—Ä–æ–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:
1. **–°—Ç–∞—Ä—Ç** - —Ä—è–¥–æ–∫ 199: `F.text == "üöñ –ó–∞–º–æ–≤–∏—Ç–∏ —Ç–∞–∫—Å—ñ"`
2. **Pickup** (–∑–≤—ñ–¥–∫–∏) - —Ä—è–¥–∫–∏ 429-497
   - location handler
   - voice handler  
   - text handler
3. **Destination** (–∫—É–¥–∏) - —Ä—è–¥–∫–∏ 505-560
   - location handler
   - text handler
4. **Car class** - –ø–æ–∫–∞–∑ —Ü—ñ–Ω —Ç–∞ –≤–∏–±—ñ—Ä
5. **Comment** - —Ä—è–¥–∫–∏ 565-651 (—î —ñ–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞ skip)
6. **Payment method** - —Ä—è–¥–æ–∫ 779
7. **Confirm** - —Ä—è–¥–æ–∫ 812 (—î —ñ–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞)

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ò

### 1. location_keyboard() - ReplyKeyboard
–†—è–¥–∫–∏ 187-197:
```python
def location_keyboard(text: str) -> ReplyKeyboardMarkup:
    return ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="üìç –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é", request_location=True)],
            [KeyboardButton(text="üé§ –ì–æ–ª–æ—Å–æ–º")],
            [KeyboardButton(text=CANCEL_TEXT)],
        ],
        ...
    )
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤:**
- pickup_location (—Ä—è–¥–æ–∫ 279)
- destination_location

### 2. –ë–∞–≥–∞—Ç–æ answer() –±–µ–∑ edit

### 3. –ù–µ–º–∞—î –∫–Ω–æ–ø–æ–∫ "–ù–∞–∑–∞–¥" –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ

---

## üéØ –ü–õ–ê–ù –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø

### –ï—Ç–∞–ø 1: –ü–æ—á–∞—Ç–æ–∫ —Ç–∞ –ª–æ–∫–∞—Ü—ñ—ó ‚è±Ô∏è ~40—Ö–≤

**–ó–º—ñ–Ω–∏:**
- [ ] –ó—Ä–æ–±–∏—Ç–∏ `start_order` (—Ä—è–¥–æ–∫ 199) —ñ–Ω–ª–∞–π–Ω –∑ –∫–Ω–æ–ø–∫–∞–º–∏ –≤–∏–±–æ—Ä—É
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω–ª–∞–π–Ω –≤–∞—Ä—ñ–∞–Ω—Ç –≤–∏–±–æ—Ä—É —Å–ø–æ—Å–æ–±—É –≤–≤–µ–¥–µ–Ω–Ω—è pickup
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω–ª–∞–π–Ω –≤–∞—Ä—ñ–∞–Ω—Ç –≤–∏–±–æ—Ä—É —Å–ø–æ—Å–æ–±—É –≤–≤–µ–¥–µ–Ω–Ω—è destination
- [ ] –î–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" —Ç–∞ "–°–∫–∞—Å—É–≤–∞—Ç–∏"
- [ ] –í–∏–¥–∞–ª—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–ü—ñ–¥—Ö—ñ–¥:**
```python
# start_order ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏:
# - üìç –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –º–æ—é –ª–æ–∫–∞—Ü—ñ—é
# - ‚úèÔ∏è –í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å—É —Ç–µ–∫—Å—Ç–æ–º
# - üìç –í–∏–±—Ä–∞—Ç–∏ –∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö
# - ‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏

# Callback address:send_location ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ ReplyKeyboard —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Ü—å–æ–º—É –∫—Ä–æ—Ü—ñ
```

### –ï—Ç–∞–ø 2: –ö–æ–º–µ–Ω—Ç–∞—Ä, –æ–ø–ª–∞—Ç–∞, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è ‚è±Ô∏è ~30—Ö–≤

**–ó–º—ñ–Ω–∏:**
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ comment - –≤–∂–µ —î —ñ–Ω–ª–∞–π–Ω skip
- [ ] –ó—Ä–æ–±–∏—Ç–∏ payment_method –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω–ª–∞–π–Ω
- [ ] –ó—Ä–æ–±–∏—Ç–∏ confirm –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω–ª–∞–π–Ω
- [ ] –î–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"

---

## üöÄ –ü–†–û–ì–†–ï–°

### ‚úÖ –ï—Ç–∞–ø 1.1: –Ü–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏ –¥–ª—è pickup/destination (–ó–ê–í–ï–†–®–ï–ù–û)

**–ó—Ä–æ–±–ª–µ–Ω–æ:**
- ‚úÖ `start_order` (—Ä—è–¥–æ–∫ 199) - —Ç–µ–ø–µ—Ä –ø–æ–∫–∞–∑—É—î —ñ–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏ –≤–∏–±–æ—Ä—É
- ‚úÖ –ù–æ–≤—ñ callback –æ–±—Ä–æ–±–Ω–∏–∫–∏:
  - `order:pickup:send_location` - –ø–æ–∫–∞–∑—É—î ReplyKeyboard —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ
  - `order:pickup:text` - –∑–∞–ø–∏—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ—ó –∞–¥—Ä–µ—Å–∏
  - `order:pickup:saved` - –ø–æ–∫–∞–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∞–¥—Ä–µ—Å
  - `order:pickup:use_saved:{id}` - –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—É –∞–¥—Ä–µ—Å—É
  - `order:pickup:back` - –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≤–∏–±–æ—Ä—É —Å–ø–æ—Å–æ–±—É
  - `order:dest:send_location` - –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—è –¥–ª—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  - `order:dest:text` - —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  - `order:dest:saved` - –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∞–¥—Ä–µ—Å–∏ –¥–ª—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  - `order:dest:use_saved:{id}` - –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  - `order:dest:back` - –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≤–∏–±–æ—Ä—É
  - `order:back:pickup` - –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ pickup –∑ destination
  - `order:back_to_destination` - –æ–Ω–æ–≤–ª–µ–Ω–∏–π –∑ —ñ–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞–º–∏
- ‚úÖ –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—Å—É–≤–∞—Ç–∏" –≤—Å—é–¥–∏
- ‚úÖ edit_text –∑–∞–º—ñ—Å—Ç—å answer –¥–µ –º–æ–∂–ª–∏–≤–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–µ–ø–µ—Ä –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω–ª–∞–π–Ω
- ReplyKeyboard –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò –¥–ª—è request_location
- –ß–∏—Å—Ç—ñ—à–∏–π —á–∞—Ç

**–ó–∞–∫–æ–º–º—ñ—á–µ–Ω–æ!**

---

### ‚è≥ –ï—Ç–∞–ø 1.2: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è Message –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ (–ù–ê–°–¢–£–ü–ù–ï)

**–¢—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏:**
- [ ] –í–∏–ø—Ä–∞–≤–∏—Ç–∏ `pickup_location` - –≤–∏–¥–∞–ª—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- [ ] –í–∏–ø—Ä–∞–≤–∏—Ç–∏ `pickup_text` - –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- [ ] –í–∏–ø—Ä–∞–≤–∏—Ç–∏ `destination_location` - –≤–∏–¥–∞–ª—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- [ ] –í–∏–ø—Ä–∞–≤–∏—Ç–∏ `destination_text` - –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- [ ] –î–æ–¥–∞—Ç–∏ edit_text –∑–∞–º—ñ—Å—Ç—å answer –≤ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö
