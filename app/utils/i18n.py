"""–ú—É–ª—å—Ç–∏–º–æ–≤–Ω—ñ—Å—Ç—å (Internationalization) –¥–ª—è –±–æ—Ç–∞"""
from typing import Dict, Optional

# –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤
TRANSLATIONS: Dict[str, Dict[str, str]] = {
    # –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é
    "menu.register": {
        "uk": "üì± –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è",
        "ru": "üì± –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
        "en": "üì± Register"
    },
    "menu.order_taxi": {
        "uk": "üöñ –ó–∞–º–æ–≤–∏—Ç–∏ —Ç–∞–∫—Å—ñ",
        "ru": "üöñ –ó–∞–∫–∞–∑–∞—Ç—å —Ç–∞–∫—Å–∏",
        "en": "üöñ Order Taxi"
    },
    "menu.my_orders": {
        "uk": "üìú –ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è",
        "ru": "üìú –ú–æ–∏ –∑–∞–∫–∞–∑—ã",
        "en": "üìú My Orders"
    },
    "menu.become_driver": {
        "uk": "üöó –°—Ç–∞—Ç–∏ –≤–æ–¥—ñ—î–º",
        "ru": "üöó –°—Ç–∞—Ç—å –≤–æ–¥–∏—Ç–µ–ª–µ–º",
        "en": "üöó Become Driver"
    },
    "menu.driver_panel": {
        "uk": "üöó –ü–∞–Ω–µ–ª—å –≤–æ–¥—ñ—è",
        "ru": "üöó –ü–∞–Ω–µ–ª—å –≤–æ–¥–∏—Ç–µ–ª—è",
        "en": "üöó Driver Panel"
    },
    "menu.admin_panel": {
        "uk": "‚öôÔ∏è –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å",
        "ru": "‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
        "en": "‚öôÔ∏è Admin Panel"
    },
    "menu.language": {
        "uk": "üåê –ú–æ–≤–∞",
        "ru": "üåê –Ø–∑—ã–∫",
        "en": "üåê Language"
    },
    "menu.help": {
        "uk": "‚ÑπÔ∏è –î–æ–ø–æ–º–æ–≥–∞",
        "ru": "‚ÑπÔ∏è –ü–æ–º–æ—â—å",
        "en": "‚ÑπÔ∏è Help"
    },
    
    # –í—ñ—Ç–∞–Ω–Ω—è
    "welcome.title": {
        "uk": "–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ Taxi Bot! üöñ",
        "ru": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Taxi Bot! üöñ",
        "en": "Welcome to Taxi Bot! üöñ"
    },
    "welcome.description": {
        "uk": "–í–∞—à –Ω–∞–¥—ñ–π–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–∫—Å—ñ",
        "ru": "–í–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∑–∞–∫–∞–∑–∞ —Ç–∞–∫—Å–∏",
        "en": "Your reliable taxi ordering assistant"
    },
    
    # –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
    "register.phone_request": {
        "uk": "üì± –ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó",
        "ru": "üì± –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "en": "üì± Share your phone number to register"
    },
    "register.city_select": {
        "uk": "üèô –û–±–µ—Ä—ñ—Ç—å –≤–∞—à–µ –º—ñ—Å—Ç–æ:",
        "ru": "üèô –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥:",
        "en": "üèô Select your city:"
    },
    "register.success": {
        "uk": "‚úÖ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ!",
        "ru": "‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!",
        "en": "‚úÖ Registration completed!"
    },
    
    # –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è
    "order.pickup_request": {
        "uk": "üìç –ó–≤—ñ–¥–∫–∏ –ø–æ–¥–∞—Ç–∏ —Ç–∞–∫—Å—ñ?\n\n–ù–∞–¥—ñ—à–ª—ñ—Ç—å –∞–¥—Ä–µ—Å—É –∞–±–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é",
        "ru": "üìç –û—Ç–∫—É–¥–∞ –ø–æ–¥–∞—Ç—å —Ç–∞–∫—Å–∏?\n\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∞–¥—Ä–µ—Å –∏–ª–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é",
        "en": "üìç Where to pick you up?\n\nSend address or location"
    },
    "order.destination_request": {
        "uk": "üìç –ö—É–¥–∏ —ó–¥–µ–º–æ?\n\n–ù–∞–¥—ñ—à–ª—ñ—Ç—å –∞–¥—Ä–µ—Å—É –∞–±–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é",
        "ru": "üìç –ö—É–¥–∞ –µ–¥–µ–º?\n\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∞–¥—Ä–µ—Å –∏–ª–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é",
        "en": "üìç Where to go?\n\nSend address or location"
    },
    "order.comment_request": {
        "uk": "üí¨ –î–æ–¥–∞–π—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):\n\n–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ø—ñ–¥'—ó–∑–¥ 3, –ø–æ–≤–µ—Ä—Ö 5",
        "ru": "üí¨ –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):\n\n–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–¥—ä–µ–∑–¥ 3, —ç—Ç–∞–∂ 5",
        "en": "üí¨ Add comment (optional):\n\nFor example: entrance 3, floor 5"
    },
    "order.confirm": {
        "uk": "üìã –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:",
        "ru": "üìã –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞:",
        "en": "üìã Check order details:"
    },
    "order.created": {
        "uk": "‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{order_id} –ø—Ä–∏–π–Ω—è—Ç–æ!\n\nüîç –®—É–∫–∞—î–º–æ –≤–æ–¥—ñ—è...",
        "ru": "‚úÖ –ó–∞–∫–∞–∑ #{order_id} –ø—Ä–∏–Ω—è—Ç!\n\nüîç –ò—â–µ–º –≤–æ–¥–∏—Ç–µ–ª—è...",
        "en": "‚úÖ Order #{order_id} accepted!\n\nüîç Looking for driver..."
    },
    "order.cancelled": {
        "uk": "‚ùå –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ",
        "ru": "‚ùå –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω",
        "en": "‚ùå Order cancelled"
    },
    
    # –í–æ–¥—ñ–π
    "driver.registration_request": {
        "uk": "üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤–æ–¥—ñ—è\n\n–í–∫–∞–∂—ñ—Ç—å –≤–∞—à–µ –ü–Ü–ë:",
        "ru": "üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è\n\n–£–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –§–ò–û:",
        "en": "üìù Driver registration\n\nEnter your full name:"
    },
    "driver.status_online": {
        "uk": "üü¢ –û–Ω–ª–∞–π–Ω",
        "ru": "üü¢ –û–Ω–ª–∞–π–Ω",
        "en": "üü¢ Online"
    },
    "driver.status_offline": {
        "uk": "üî¥ –û—Ñ–ª–∞–π–Ω",
        "ru": "üî¥ –û—Ñ–ª–∞–π–Ω",
        "en": "üî¥ Offline"
    },
    "driver.order_accepted": {
        "uk": "‚úÖ –í–∏ –ø—Ä–∏–π–Ω—è–ª–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!",
        "ru": "‚úÖ –í—ã –ø—Ä–∏–Ω—è–ª–∏ –∑–∞–∫–∞–∑!",
        "en": "‚úÖ You accepted the order!"
    },
    
    # –°—Ç–∞—Ç—É—Å–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    "status.pending": {
        "uk": "‚è≥ –û—á—ñ–∫—É—î—Ç—å—Å—è",
        "ru": "‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è",
        "en": "‚è≥ Pending"
    },
    "status.accepted": {
        "uk": "‚úÖ –ü—Ä–∏–π–Ω—è—Ç–æ",
        "ru": "‚úÖ –ü—Ä–∏–Ω—è—Ç–æ",
        "en": "‚úÖ Accepted"
    },
    "status.in_progress": {
        "uk": "üöó –í –¥–æ—Ä–æ–∑—ñ",
        "ru": "üöó –í –ø—É—Ç–∏",
        "en": "üöó In Progress"
    },
    "status.completed": {
        "uk": "‚úîÔ∏è –ó–∞–≤–µ—Ä—à–µ–Ω–æ",
        "ru": "‚úîÔ∏è –ó–∞–≤–µ—Ä—à–µ–Ω–æ",
        "en": "‚úîÔ∏è Completed"
    },
    "status.cancelled": {
        "uk": "‚ùå –°–∫–∞—Å–æ–≤–∞–Ω–æ",
        "ru": "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ",
        "en": "‚ùå Cancelled"
    },
    
    # –ö–Ω–æ–ø–∫–∏
    "btn.cancel": {
        "uk": "‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏",
        "ru": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å",
        "en": "‚ùå Cancel"
    },
    "btn.skip": {
        "uk": "‚è© –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏",
        "ru": "‚è© –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å",
        "en": "‚è© Skip"
    },
    "btn.confirm": {
        "uk": "‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏",
        "ru": "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
        "en": "‚úÖ Confirm"
    },
    "btn.send_location": {
        "uk": "üìç –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é",
        "ru": "üìç –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é",
        "en": "üìç Send Location"
    },
    "btn.share_phone": {
        "uk": "üì± –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –Ω–æ–º–µ—Ä–æ–º",
        "ru": "üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º",
        "en": "üì± Share Phone"
    },
    
    # –ó–∞–≥–∞–ª—å–Ω—ñ
    "common.client": {
        "uk": "–ö–ª—ñ—î–Ω—Ç",
        "ru": "–ö–ª–∏–µ–Ω—Ç",
        "en": "Client"
    },
    "common.driver": {
        "uk": "–í–æ–¥—ñ–π",
        "ru": "–í–æ–¥–∏—Ç–µ–ª—å",
        "en": "Driver"
    },
    "common.phone": {
        "uk": "–¢–µ–ª–µ—Ñ–æ–Ω",
        "ru": "–¢–µ–ª–µ—Ñ–æ–Ω",
        "en": "Phone"
    },
    "common.city": {
        "uk": "–ú—ñ—Å—Ç–æ",
        "ru": "–ì–æ—Ä–æ–¥",
        "en": "City"
    },
    "common.from": {
        "uk": "–ó–≤—ñ–¥–∫–∏",
        "ru": "–û—Ç–∫—É–¥–∞",
        "en": "From"
    },
    "common.to": {
        "uk": "–ö—É–¥–∏",
        "ru": "–ö—É–¥–∞",
        "en": "To"
    },
    "common.comment": {
        "uk": "–ö–æ–º–µ–Ω—Ç–∞—Ä",
        "ru": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
        "en": "Comment"
    },
    "common.distance": {
        "uk": "–í—ñ–¥—Å—Ç–∞–Ω—å",
        "ru": "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ",
        "en": "Distance"
    },
    "common.fare": {
        "uk": "–í–∞—Ä—Ç—ñ—Å—Ç—å",
        "ru": "–°—Ç–æ–∏–º–æ—Å—Ç—å",
        "en": "Fare"
    },
    "common.rating": {
        "uk": "–†–µ–π—Ç–∏–Ω–≥",
        "ru": "–†–µ–π—Ç–∏–Ω–≥",
        "en": "Rating"
    },
    
    # –ü–ª–∞—Ç–µ–∂—ñ
    "payment.commission": {
        "uk": "üí≥ –ö–æ–º—ñ—Å—ñ—è",
        "ru": "üí≥ –ö–æ–º–∏—Å—Å–∏—è",
        "en": "üí≥ Commission"
    },
    "payment.qr_title": {
        "uk": "üì± –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ QR-–∫–æ–¥",
        "ru": "üì± –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ QR-–∫–æ–¥",
        "en": "üì± Payment via QR code"
    },
    "payment.scan_qr": {
        "uk": "–í—ñ–¥—Å–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç–∏:",
        "ru": "–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã:",
        "en": "Scan QR code to pay:"
    },
    "payment.card_number": {
        "uk": "–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏:",
        "ru": "–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:",
        "en": "Card number:"
    },
    "payment.amount": {
        "uk": "–°—É–º–∞:",
        "ru": "–°—É–º–º–∞:",
        "en": "Amount:"
    },
    
    # –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –∞–¥—Ä–µ—Å–∏
    "saved.home": {
        "uk": "üè† –î–æ–¥–æ–º—É",
        "ru": "üè† –î–æ–º–æ–π",
        "en": "üè† Home"
    },
    "saved.work": {
        "uk": "üíº –ù–∞ —Ä–æ–±–æ—Ç—É",
        "ru": "üíº –ù–∞ —Ä–∞–±–æ—Ç—É",
        "en": "üíº To Work"
    },
    "saved.add": {
        "uk": "‚ûï –î–æ–¥–∞—Ç–∏ –∞–¥—Ä–µ—Å—É",
        "ru": "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å",
        "en": "‚ûï Add Address"
    },
    "saved.manage": {
        "uk": "‚öôÔ∏è –ö–µ—Ä—É–≤–∞—Ç–∏ –∞–¥—Ä–µ—Å–∞–º–∏",
        "ru": "‚öôÔ∏è –£–ø—Ä–∞–≤–ª—è—Ç—å –∞–¥—Ä–µ—Å–∞–º–∏",
        "en": "‚öôÔ∏è Manage Addresses"
    },
    
    # –ü—Ä–∏—á–∏–Ω–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
    "cancel.reason_title": {
        "uk": "‚ùå –ß–æ–º—É –≤–∏ —Å–∫–∞—Å–æ–≤—É—î—Ç–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?",
        "ru": "‚ùå –ü–æ—á–µ–º—É –≤—ã –æ—Ç–º–µ–Ω—è–µ—Ç–µ –∑–∞–∫–∞–∑?",
        "en": "‚ùå Why are you cancelling?"
    },
    "cancel.reason.wait_long": {
        "uk": "‚è∞ –í–æ–¥—ñ–π –¥–æ–≤–≥–æ —ó–¥–µ",
        "ru": "‚è∞ –í–æ–¥–∏—Ç–µ–ª—å –¥–æ–ª–≥–æ –µ–¥–µ—Ç",
        "en": "‚è∞ Driver taking too long"
    },
    "cancel.reason.wrong_address": {
        "uk": "üìç –ü–æ–º–∏–ª–∫–∞ –≤ –∞–¥—Ä–µ—Å—ñ",
        "ru": "üìç –û—à–∏–±–∫–∞ –≤ –∞–¥—Ä–µ—Å–µ",
        "en": "üìç Wrong address"
    },
    "cancel.reason.changed_mind": {
        "uk": "ü§∑ –ü–µ—Ä–µ–¥—É–º–∞–≤",
        "ru": "ü§∑ –ü–µ—Ä–µ–¥—É–º–∞–ª",
        "en": "ü§∑ Changed my mind"
    },
    "cancel.reason.found_other": {
        "uk": "üöï –ó–Ω–∞–π—à–æ–≤ —ñ–Ω—à–µ —Ç–∞–∫—Å—ñ",
        "ru": "üöï –ù–∞—à–µ–ª –¥—Ä—É–≥–æ–µ —Ç–∞–∫—Å–∏",
        "en": "üöï Found another taxi"
    },
    "cancel.reason.other": {
        "uk": "‚ùì –Ü–Ω—à–µ",
        "ru": "‚ùì –î—Ä—É–≥–æ–µ",
        "en": "‚ùì Other"
    },
}


def get_text(key: str, lang: str = "uk", **kwargs) -> str:
    """–û—Ç—Ä–∏–º–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥ —Ç–µ–∫—Å—Ç—É –∑–∞ –∫–ª—é—á–µ–º
    
    Args:
        key: –ö–ª—é—á –ø–µ—Ä–µ–∫–ª–∞–¥—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "menu.order_taxi")
        lang: –ö–æ–¥ –º–æ–≤–∏ (uk, ru, en)
        **kwargs: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, order_id=123)
    
    Returns:
        –ü–µ—Ä–µ–∫–ª–∞–¥–µ–Ω–∏–π —Ç–µ–∫—Å—Ç
    """
    if key not in TRANSLATIONS:
        return key
    
    translation = TRANSLATIONS[key].get(lang, TRANSLATIONS[key].get("uk", key))
    
    # –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
    if kwargs:
        try:
            translation = translation.format(**kwargs)
        except KeyError:
            pass
    
    return translation


def get_user_language(user_language_code: Optional[str]) -> str:
    """–í–∏–∑–Ω–∞—á–∏—Ç–∏ –º–æ–≤—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    
    Args:
        user_language_code: –ö–æ–¥ –º–æ–≤–∏ –∑ Telegram (uk, ru, en —Ç–æ—â–æ)
    
    Returns:
        –ö–æ–¥ –º–æ–≤–∏ (uk, ru, en)
    """
    if not user_language_code:
        return "uk"
    
    lang = user_language_code.lower()
    
    # –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –º–æ–≤–∏
    if lang in ["uk", "ukr"]:
        return "uk"
    elif lang in ["ru", "rus"]:
        return "ru"
    elif lang in ["en", "eng"]:
        return "en"
    
    # –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞
    return "uk"
