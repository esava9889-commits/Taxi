# üí≥ –ó–í–Ü–¢ –ü–†–û –°–ò–°–¢–ï–ú–£ –û–ü–õ–ê–¢–ò

## ‚úÖ **–î–û–î–ê–ù–û –ù–û–í–£ –§–£–ù–ö–¶–Ü–û–ù–ê–õ–¨–ù–Ü–°–¢–¨:**

---

## üéØ **–©–û –†–ï–ê–õ–Ü–ó–û–í–ê–ù–û:**

### **1. –í–∏–±—ñ—Ä —Å–ø–æ—Å–æ–±—É –æ–ø–ª–∞—Ç–∏ –ø–µ—Ä–µ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º**

**–ö–ª—ñ—î–Ω—Ç –æ–±–∏—Ä–∞—î:**
- üíµ **–ì–æ—Ç—ñ–≤–∫–∞** - —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑ –≤–æ–¥—ñ—î–º –ø—ñ—Å–ª—è –ø–æ—ó–∑–¥–∫–∏
- üí≥ **–ö–∞—Ä—Ç–∫–∞** - –ø–µ—Ä–µ–∫–∞–∑ –Ω–∞ –∫–∞—Ä—Ç–∫—É –≤–æ–¥—ñ—è

**–ö–æ–ª–∏:** –ü—ñ—Å–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è, –ø–µ—Ä–µ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

**–°–∫—Ä—ñ–Ω—à–æ—Ç:**
```
üí∞ –û–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏:

üíµ –ì–æ—Ç—ñ–≤–∫–∞ - —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑ –≤–æ–¥—ñ—î–º
üí≥ –ö–∞—Ä—Ç–∫–∞ - –ø–µ—Ä–µ–∫–∞–∑ –Ω–∞ –∫–∞—Ä—Ç–∫—É –≤–æ–¥—ñ—è

[üíµ –ì–æ—Ç—ñ–≤–∫–∞]  [üí≥ –ö–∞—Ä—Ç–∫–∞]
```

---

### **2. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –æ–ø–ª–∞—Ç–∏ –∫–∞—Ä—Ç–∫–æ—é**

–Ø–∫—â–æ –æ–±—Ä–∞–Ω–∞ **–∫–∞—Ä—Ç–∫–∞**:

```
üí≥ –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é

‚úÖ –°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏ –æ–±—Ä–∞–Ω–æ!

üìå –ö–∞—Ä—Ç–∫–∞ –≤–æ–¥—ñ—è –∑'—è–≤–∏—Ç—å—Å—è –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Ç–æ–≥–æ,
—è–∫ –≤—ñ–Ω –ø—Ä–∏–π–º–µ –≤–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.
```

---

### **3. –ì–∞–º–∞–Ω–µ—Ü—å –≤–æ–¥—ñ—è (üíº)**

**–ù–æ–≤–∞ –∫–Ω–æ–ø–∫–∞ –≤ –∫–∞–±—ñ–Ω–µ—Ç—ñ –≤–æ–¥—ñ—è: üíº –ì–∞–º–∞–Ω–µ—Ü—å**

**–Ø–∫—â–æ –∫–∞—Ä—Ç–∫–∞ –Ω–µ –¥–æ–¥–∞–Ω–∞:**
```
üíº –í–∞—à –≥–∞–º–∞–Ω–µ—Ü—å

‚ùå –ö–∞—Ä—Ç–∫–∞ –Ω–µ –¥–æ–¥–∞–Ω–∞

–î–æ–¥–∞–π—Ç–µ –∫–∞—Ä—Ç–∫—É, —â–æ–± –∫–ª—ñ—î–Ω—Ç–∏ –º–æ–≥–ª–∏
–ø–µ—Ä–µ–∫–∞–∑—É–≤–∞—Ç–∏ –≤–∞–º –æ–ø–ª–∞—Ç—É.

[‚ûï –î–æ–¥–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É]
```

**–Ø–∫—â–æ –∫–∞—Ä—Ç–∫–∞ –¥–æ–¥–∞–Ω–∞:**
```
üíº –í–∞—à –≥–∞–º–∞–Ω–µ—Ü—å

üí≥ –ö–∞—Ä—Ç–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç–∏:
1234 5678 9012 3456

‚ÑπÔ∏è –¶—è –∫–∞—Ä—Ç–∫–∞ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç–∞–º,
—è–∫—ñ –æ–±–∏—Ä–∞—é—Ç—å –æ–ø–ª–∞—Ç—É –∫–∞—Ä—Ç–∫–æ—é.

[‚úèÔ∏è –ó–º—ñ–Ω–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É]
```

**–î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏:**
```
üí≥ –í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏

–§–æ—Ä–º–∞—Ç: 1234 5678 9012 3456
–∞–±–æ: 1234567890123456

–¶—è –∫–∞—Ä—Ç–∫–∞ –±—É–¥–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏—Å—å –∫–ª—ñ—î–Ω—Ç–∞–º
–¥–ª—è –æ–ø–ª–∞—Ç–∏ –ø–æ—ó–∑–¥–∫–∏.
```

---

### **4. –ö–∞—Ä—Ç–∫–∞ –≤–æ–¥—ñ—è –ø—ñ—Å–ª—è –ø—Ä–∏–π–Ω—è—Ç—Ç—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è**

–ö–æ–ª–∏ –≤–æ–¥—ñ–π –ø—Ä–∏–π–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑ –æ–ø–ª–∞—Ç–æ—é **–∫–∞—Ä—Ç–∫–æ—é**:

**–ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º—É—î:**
```
‚úÖ –í–æ–¥—ñ–π –ø—Ä–∏–π–Ω—è–≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!

üöó –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ
üì± +380501234567

üí≥ –ö–∞—Ä—Ç–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç–∏:
1234 5678 9012 3456

üí∞ –î–æ —Å–ø–ª–∞—Ç–∏: 150 –≥—Ä–Ω

[üí≥ –°–ø–ª–∞—Ç–∏—Ç–∏ –ø–æ—ó–∑–¥–∫—É]
```

–Ø–∫—â–æ –æ–ø–ª–∞—Ç–∞ **–≥–æ—Ç—ñ–≤–∫–æ—é**:
```
‚úÖ –í–æ–¥—ñ–π –ø—Ä–∏–π–Ω—è–≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!

üöó –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ
üì± +380501234567

üíµ –û–ø–ª–∞—Ç–∞ –≥–æ—Ç—ñ–≤–∫–æ—é
```

---

## üíæ **–ó–ú–Ü–ù–ò –í –ë–î:**

### **–¢–∞–±–ª–∏—Ü—è `orders`:**
```sql
ALTER TABLE orders ADD COLUMN payment_method TEXT NOT NULL DEFAULT 'cash';
```

–ó–Ω–∞—á–µ–Ω–Ω—è: `'cash'` | `'card'`

### **–¢–∞–±–ª–∏—Ü—è `drivers`:**
```sql
ALTER TABLE drivers ADD COLUMN card_number TEXT;
```

–§–æ—Ä–º–∞—Ç: `'1234 5678 9012 3456'`

---

## üìù **–ó–ú–Ü–ù–ò –í –ö–û–î–Ü:**

### **1. app/storage/db.py**

```python
@dataclass
class Order:
    ...
    payment_method: str = "cash"  # cash | card

@dataclass
class Driver:
    ...
    card_number: Optional[str] = None
```

### **2. app/handlers/order.py**

**–î–æ–¥–∞–Ω–æ —Å—Ç–∞–Ω:**
```python
class OrderStates(StatesGroup):
    ...
    payment_method = State()  # –í–∏–±—ñ—Ä –æ–ø–ª–∞—Ç–∏
```

**–û–±—Ä–æ–±–Ω–∏–∫ –≤–∏–±–æ—Ä—É:**
```python
@router.callback_query(F.data.startswith("payment:"))
async def select_payment_method(call: CallbackQuery, state: FSMContext):
    payment_method = call.data.split(":")[1]  # cash/card
    await state.update_data(payment_method=payment_method)
    
    if payment_method == "card":
        await call.message.edit_text(
            "üí≥ –ö–∞—Ä—Ç–∫–∞ –∑'—è–≤–∏—Ç—å—Å—è –ø—ñ—Å–ª—è –ø—Ä–∏–π–Ω—è—Ç—Ç—è"
        )
```

**–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Order:**
```python
order = Order(
    ...
    payment_method=data.get("payment_method", "cash")
)
```

### **3. app/handlers/driver_panel.py**

**–ì–∞–º–∞–Ω–µ—Ü—å:**
```python
@router.message(F.text == "üíº –ì–∞–º–∞–Ω–µ—Ü—å")
async def show_wallet(message: Message):
    if driver.card_number:
        # –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É + –∫–Ω–æ–ø–∫–∞ "–ó–º—ñ–Ω–∏—Ç–∏"
    else:
        # –ö–Ω–æ–ø–∫–∞ "–î–æ–¥–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É"
```

**–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏:**
```python
@router.message(F.text.regexp(r'^\d{4}\s?\d{4}\s?\d{4}\s?\d{4}$'))
async def save_card_number(message: Message):
    # –§–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ —è–∫ 1234 5678 9012 3456
    # –ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –ë–î
```

**–ü–æ–∫–∞–∑ –∫–∞—Ä—Ç–∫–∏ –∫–ª—ñ—î–Ω—Ç—É:**
```python
@router.callback_query(F.data.startswith("accept_order:"))
async def accept(call: CallbackQuery):
    if order.payment_method == "card" and driver.card_number:
        await call.bot.send_message(
            order.user_id,
            f"üí≥ –ö–∞—Ä—Ç–∫–∞: {driver.card_number}\n"
            f"üí∞ –î–æ —Å–ø–ª–∞—Ç–∏: {order.fare_amount} –≥—Ä–Ω",
            reply_markup=pay_button
        )
```

---

## üîÑ **–°–¶–ï–ù–ê–†–Ü–ô –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø:**

### **–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é:**

```
1. –ö–ª—ñ—î–Ω—Ç –∑–∞–º–æ–≤–ª—è—î —Ç–∞–∫—Å—ñ
   ‚îú‚îÄ –í–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å–∏
   ‚îú‚îÄ –ö–æ–º–µ–Ω—Ç–∞—Ä
   ‚îî‚îÄ –û–±–∏—Ä–∞—î: üí≥ –ö–∞—Ä—Ç–∫–∞
   
2. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: "–ö–∞—Ä—Ç–∫–∞ –∑'—è–≤–∏—Ç—å—Å—è –ø—ñ—Å–ª—è –ø—Ä–∏–π–Ω—è—Ç—Ç—è"

3. –í–æ–¥—ñ–π –ø—Ä–∏–π–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
   
4. –ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º—É—î:
   ‚îú‚îÄ –î–∞–Ω—ñ –≤–æ–¥—ñ—è
   ‚îú‚îÄ üí≥ –ö–∞—Ä—Ç–∫–∞: 1234 5678 9012 3456
   ‚îú‚îÄ üí∞ –î–æ —Å–ø–ª–∞—Ç–∏: 150 –≥—Ä–Ω
   ‚îî‚îÄ [üí≥ –°–ø–ª–∞—Ç–∏—Ç–∏ –ø–æ—ó–∑–¥–∫—É]
   
5. –ö–ª—ñ—î–Ω—Ç –ø–µ—Ä–µ–∫–∞–∑—É—î –≥—Ä–æ—à—ñ
   
6. –í–æ–¥—ñ–π –∑–∞–≤–µ—Ä—à—É—î –ø–æ—ó–∑–¥–∫—É
```

### **–û–ø–ª–∞—Ç–∞ –≥–æ—Ç—ñ–≤–∫–æ—é:**

```
1. –ö–ª—ñ—î–Ω—Ç –∑–∞–º–æ–≤–ª—è—î —Ç–∞–∫—Å—ñ
   ‚îú‚îÄ –í–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å–∏
   ‚îú‚îÄ –ö–æ–º–µ–Ω—Ç–∞—Ä
   ‚îî‚îÄ –û–±–∏—Ä–∞—î: üíµ –ì–æ—Ç—ñ–≤–∫–∞
   
2. –í–æ–¥—ñ–π –ø—Ä–∏–π–º–∞—î
   
3. –ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º—É—î:
   ‚îú‚îÄ –î–∞–Ω—ñ –≤–æ–¥—ñ—è
   ‚îî‚îÄ üíµ –û–ø–ª–∞—Ç–∞ –≥–æ—Ç—ñ–≤–∫–æ—é
   
4. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑ –≤–æ–¥—ñ—î–º –ø—ñ—Å–ª—è –ø–æ—ó–∑–¥–∫–∏
```

---

## üìä **–ü–ï–†–ï–í–ê–ì–ò:**

‚úÖ **–í–∏–±—ñ—Ä —Å–ø–æ—Å–æ–±—É –æ–ø–ª–∞—Ç–∏** - –∑—Ä—É—á–Ω—ñ—Å—Ç—å –¥–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤  
‚úÖ **–ö–∞—Ä—Ç–∫–∞ –≤–æ–¥—ñ—è** - –±–µ–∑–ø–µ–∫–∞ —Ç–∞ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ–∫–∞–∑** - –ø—ñ—Å–ª—è –ø—Ä–∏–π–Ω—è—Ç—Ç—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è  
‚úÖ **–ì–∞–º–∞–Ω–µ—Ü—å –≤–æ–¥—ñ—è** - –ª–µ–≥–∫–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–∑–º—ñ–Ω–∞ –∫–∞—Ä—Ç–∫–∏  
‚úÖ **–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ (1234 5678 9012 3456)  

---

## üöÄ **–ö–û–ú–Ü–¢:**

```
–ö–æ–º—ñ—Ç: 7b676b9
–ì—ñ–ª–∫–∞: fix-taxi-bot
–ó–º—ñ–Ω–∏:
  - app/storage/db.py (+4 –ø–æ–ª—è)
  - app/handlers/order.py (+50 —Ä—è–¥–∫—ñ–≤)
  - app/handlers/driver_panel.py (+80 —Ä—è–¥–∫—ñ–≤)
```

---

## üéØ **–¢–ï–ü–ï–† –ü–†–ê–¶–Æ–Ñ:**

‚úÖ –ö–ª—ñ—î–Ω—Ç –æ–±–∏—Ä–∞—î —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏  
‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫–∞—Ä—Ç–∫—É  
‚úÖ –ì–∞–º–∞–Ω–µ—Ü—å –≤–æ–¥—ñ—è –∑ –∫–Ω–æ–ø–∫–æ—é  
‚úÖ –ö–∞—Ä—Ç–∫–∞ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É  
‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–ø–ª–∞—Ç–∏—Ç–∏ –ø–æ—ó–∑–¥–∫—É"  
‚úÖ –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏  

**–°–ò–°–¢–ï–ú–ê –û–ü–õ–ê–¢–ò –ì–û–¢–û–í–ê!** üéâ
