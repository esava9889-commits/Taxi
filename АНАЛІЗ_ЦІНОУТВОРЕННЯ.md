# ğŸ“Š ĞĞĞĞ›Ğ†Ğ— Ğ¤ĞĞ ĞœĞ£Ğ›Ğ˜ Ğ¦Ğ†ĞĞĞ£Ğ¢Ğ’ĞĞ Ğ•ĞĞĞ¯

## âœ… ĞŸĞ†Ğ”Ğ¢Ğ’Ğ•Ğ Ğ”Ğ–Ğ•ĞĞ: Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° Ğ¿Ñ€Ğ°Ñ†ÑÑ” ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ!

---

## 1ï¸âƒ£ Ğ‘ĞĞ—ĞĞ’Ğ˜Ğ™ Ğ¢ĞĞ Ğ˜Ğ¤ (Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ°)

### Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:
```python
base_fare = max(
    tariff.minimum,
    tariff.base_fare + (distance_km * tariff.per_km) + (duration_minutes * tariff.per_minute)
)
```

### ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸ Ğ· Ğ‘Ğ” (Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ÑÑ” Ğ°Ğ´Ğ¼Ñ–Ğ½):
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | ĞĞ¿Ğ¸Ñ | ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´ |
|----------|------|---------|
| `base_fare` | Ğ¤Ñ–ĞºÑĞ¾Ğ²Ğ°Ğ½Ğ° ÑÑ‚Ğ°Ğ²ĞºĞ° | 50 Ğ³Ñ€Ğ½ |
| `per_km` | Ğ¦Ñ–Ğ½Ğ° Ğ·Ğ° ĞºÑ–Ğ»Ğ¾Ğ¼ĞµÑ‚Ñ€ | 10 Ğ³Ñ€Ğ½ |
| `per_minute` | Ğ¦Ñ–Ğ½Ğ° Ğ·Ğ° Ñ…Ğ²Ğ¸Ğ»Ğ¸Ğ½Ñƒ | 2 Ğ³Ñ€Ğ½ |
| `minimum` | ĞœÑ–Ğ½Ñ–Ğ¼Ğ°Ğ»ÑŒĞ½Ğ° Ñ†Ñ–Ğ½Ğ° | 80 Ğ³Ñ€Ğ½ |

### ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´Ğ¸ Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ…ÑƒĞ½ĞºÑƒ:

#### ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ° Ğ¿Ğ¾Ñ—Ğ·Ğ´ĞºĞ° (3 ĞºĞ¼, 10 Ñ…Ğ²):
```
Ñ†Ñ–Ğ½Ğ° = 50 + (3 * 10) + (10 * 2) = 50 + 30 + 20 = 100 Ğ³Ñ€Ğ½
Ñ„Ñ–Ğ½Ğ°Ğ» = max(80, 100) = 100 Ğ³Ñ€Ğ½ âœ…
```

#### Ğ”Ğ¾Ğ²Ğ³Ğ° Ğ¿Ğ¾Ñ—Ğ·Ğ´ĞºĞ° (185 ĞºĞ¼, 120 Ñ…Ğ²):
```
Ñ†Ñ–Ğ½Ğ° = 50 + (185 * 10) + (120 * 2) = 50 + 1850 + 240 = 2140 Ğ³Ñ€Ğ½
Ñ„Ñ–Ğ½Ğ°Ğ» = max(80, 2140) = 2140 Ğ³Ñ€Ğ½ âœ…
```

---

## 2ï¸âƒ£ ĞœĞĞĞ–ĞĞ˜Ğš ĞšĞ›ĞĞ¡Ğ£ ĞĞ’Ğ¢Ğ

### Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:
```python
class_fare = base_fare * class_multiplier
```

### ĞœĞ½Ğ¾Ğ¶Ğ½Ğ¸ĞºĞ¸ (Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ÑÑ” Ğ°Ğ´Ğ¼Ñ–Ğ½):
| ĞšĞ»Ğ°Ñ | ĞœĞ½Ğ¾Ğ¶Ğ½Ğ¸Ğº | ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´ (base=2140) |
|------|---------|---------------------|
| ğŸš— Ğ•ĞºĞ¾Ğ½Ğ¾Ğ¼ | 1.0 | 2140 Ğ³Ñ€Ğ½ |
| ğŸš™ Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ | 1.3 | 2782 Ğ³Ñ€Ğ½ (+30%) |
| ğŸš˜ ĞšĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚ | 1.6 | 3424 Ğ³Ñ€Ğ½ (+60%) |
| ğŸ† Ğ‘Ñ–Ğ·Ğ½ĞµÑ | 2.0 | 4280 Ğ³Ñ€Ğ½ (+100%) |

---

## 3ï¸âƒ£ Ğ”Ğ˜ĞĞĞœĞ†Ğ§ĞĞ† ĞĞĞ¦Ğ†ĞĞšĞ˜

### Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:
```python
total_multiplier = time_mult * weather_mult * demand_mult
final_price = class_fare * total_multiplier
```

### 3.1 Ğ§Ğ°ÑĞ¾Ğ²Ñ– Ğ½Ğ°Ñ†Ñ–Ğ½ĞºĞ¸:

| Ğ£Ğ¼Ğ¾Ğ²Ğ° | ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´ |
|-------|----------|---------|
| ğŸŒ™ ĞÑ–Ñ‡ (23:00-06:00) | `night_percent` | +50% |
| ğŸ”¥ ĞŸÑ–ĞºĞ¾Ğ²Ğ¸Ğ¹ Ñ‡Ğ°Ñ (7-9, 17-19) | `peak_hours_percent` | +30% |
| ğŸ‰ Ğ’Ğ¸Ñ…Ñ–Ğ´Ğ½Ñ– (ĞŸÑ‚-ĞĞ´ 18-23) | `weekend_percent` | +20% |
| ğŸ“… ĞŸĞ¾Ğ½ĞµĞ´Ñ–Ğ»Ğ¾Ğº (7-10) | `monday_morning_percent` | +15% |

### 3.2 ĞŸĞ¾Ğ¿Ğ¸Ñ‚ (Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ / Ğ²Ğ¾Ğ´Ñ–Ñ—):

| Ğ¡Ğ¿Ñ–Ğ²Ğ²Ñ–Ğ´Ğ½Ğ¾ÑˆĞµĞ½Ğ½Ñ | ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | ĞœĞ½Ğ¾Ğ¶Ğ½Ğ¸Ğº |
|----------------|----------|---------|
| ratio > 3 | `demand_very_high_percent` | +40% ğŸ”¥ğŸ”¥ğŸ”¥ |
| ratio > 2 | `demand_high_percent` | +25% ğŸ”¥ğŸ”¥ |
| ratio > 1.5 | `demand_medium_percent` | +15% ğŸ”¥ |
| ratio < 0.3 | `demand_low_discount_percent` | -10% |
| Ğ½ĞµĞ¼Ğ°Ñ” Ğ²Ğ¾Ğ´Ñ–Ñ—Ğ² | `no_drivers_percent` | +50% |

### 3.3 ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ°:
| Ğ£Ğ¼Ğ¾Ğ²Ğ° | ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | ĞœĞ½Ğ¾Ğ¶Ğ½Ğ¸Ğº |
|-------|----------|---------|
| ğŸŒ§ï¸ ĞŸĞ¾Ğ³Ğ°Ğ½Ñ– ÑƒĞ¼Ğ¾Ğ²Ğ¸ | `weather_percent` | 0-100% |

---

## ğŸ“ ĞŸĞĞ’ĞĞ˜Ğ™ ĞŸĞ Ğ˜ĞšĞ›ĞĞ” Ğ ĞĞ—Ğ ĞĞ¥Ğ£ĞĞšĞ£

### Ğ’Ñ…Ñ–Ğ´Ğ½Ñ– Ğ´Ğ°Ğ½Ñ–:
- ğŸ“ Ğ’Ñ–Ğ´ÑÑ‚Ğ°Ğ½ÑŒ: **185 ĞºĞ¼**
- â± Ğ§Ğ°Ñ: **120 Ñ…Ğ²**
- ğŸš— ĞšĞ»Ğ°Ñ: **Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚**
- â° Ğ§Ğ°Ñ Ğ´Ğ¾Ğ±Ğ¸: **18:00** (Ğ¿Ñ–ĞºĞ¾Ğ²Ğ¸Ğ¹)
- ğŸ‘¥ Ğ’Ğ¾Ğ´Ñ–Ñ— Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½: **5**
- ğŸ“ Pending orders: **12** (ratio = 12/5 = 2.4)

### ĞšÑ€Ğ¾Ğº 1: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ¸Ğ¹ Ñ‚Ğ°Ñ€Ğ¸Ñ„
```
base = 50 + (185 * 10) + (120 * 2) = 2140 Ğ³Ñ€Ğ½
```

### ĞšÑ€Ğ¾Ğº 2: ĞšĞ»Ğ°Ñ Ğ°Ğ²Ñ‚Ğ¾ (Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ = 1.3)
```
class_fare = 2140 * 1.3 = 2782 Ğ³Ñ€Ğ½
```

### ĞšÑ€Ğ¾Ğº 3: Ğ”Ğ¸Ğ½Ğ°Ğ¼Ñ–Ñ‡Ğ½Ñ– Ğ½Ğ°Ñ†Ñ–Ğ½ĞºĞ¸
```
ĞŸÑ–ĞºĞ¾Ğ²Ğ¸Ğ¹ Ñ‡Ğ°Ñ: 1.0 * 1.3 = 1.3        (+30%)
ĞŸĞ¾Ğ¿Ğ¸Ñ‚ (ratio=2.4): 1.3 * 1.25 = 1.625  (+25%)
ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ°: 1.625 * 1.0 = 1.625         (0%)

total_multiplier = 1.625
```

### ĞšÑ€Ğ¾Ğº 4: Ğ¤Ñ–Ğ½Ğ°Ğ»ÑŒĞ½Ğ° Ñ†Ñ–Ğ½Ğ°
```
final = 2782 * 1.625 = 4521 Ğ³Ñ€Ğ½ ğŸ”¥ğŸ”¥
```

---

## âœ… Ğ’Ğ˜Ğ¡ĞĞĞ’ĞĞš

### Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ:
1. âœ… Ğ’Ñ€Ğ°Ñ…Ğ¾Ğ²ÑƒÑ” Ğ²Ñ–Ğ´ÑÑ‚Ğ°Ğ½ÑŒ (`distance_km * per_km`)
2. âœ… Ğ’Ñ€Ğ°Ñ…Ğ¾Ğ²ÑƒÑ” Ñ‡Ğ°Ñ (`duration_minutes * per_minute`)
3. âœ… Ğ—Ğ°ÑÑ‚Ğ¾ÑĞ¾Ğ²ÑƒÑ” Ğ¼Ñ–Ğ½Ñ–Ğ¼ÑƒĞ¼ (`max(minimum, ...)`)
4. âœ… ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ½Ğ° ĞºĞ»Ğ°Ñ Ğ°Ğ²Ñ‚Ğ¾
5. âœ… Ğ—Ğ°ÑÑ‚Ğ¾ÑĞ¾Ğ²ÑƒÑ” Ğ’Ğ¡Ğ† Ğ´Ğ¸Ğ½Ğ°Ğ¼Ñ–Ñ‡Ğ½Ñ– Ğ½Ğ°Ñ†Ñ–Ğ½ĞºĞ¸:
   - Ğ§Ğ°Ñ Ğ´Ğ¾Ğ±Ğ¸ (Ğ½Ñ–Ñ‡, Ğ¿Ñ–ĞºĞ¾Ğ²Ğ¸Ğ¹, Ğ²Ğ¸Ñ…Ñ–Ğ´Ğ½Ñ–)
   - ĞŸĞ¾Ğ¿Ğ¸Ñ‚ (Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ/Ğ²Ğ¾Ğ´Ñ–Ñ—)
   - ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ°

### Ğ’Ğ˜ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ Ğ² ĞºĞ¾Ğ´Ñ–:
- âœ… `webapp_order_handler` Ñ‚ĞµĞ¿ĞµÑ€ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ” `pending_count`
- âœ… ĞŸĞµÑ€ĞµĞ´Ğ°Ñ” Ğ’Ğ¡Ğ† Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸ Ğ² `calculate_dynamic_price()`
- âœ… Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ· Ğ‘Ğ” (PricingSettings)

### Ğ”Ğµ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ:
1. âœ… `app/handlers/webapp_api.py` - Ğ½Ğ¾Ğ²Ğ¸Ğ¹ API (Ğ’Ğ˜ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ!)
2. âœ… `app/handlers/order.py` - ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¸Ğ¹ flow
3. âœ… `app/handlers/webapp.py` - WebApp data handler

---

## ğŸ¯ Ğ¢Ğ•Ğ¡Ğ¢Ğ£Ğ’ĞĞĞĞ¯

Ğ”Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸:
1. Ğ’ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ñ–Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ñ–Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
2. Ğ—Ñ€Ğ¾Ğ±Ñ–Ñ‚ÑŒ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ
3. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ñ‚Ğµ Ñ‰Ğ¾ Ñ†Ñ–Ğ½Ğ° Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ñ” Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ– Ğ²Ğ¸Ñ‰Ğµ

### Ğ›Ğ¾Ğ³ Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑ”:
```
Dynamic pricing: base=2782.0, final=4521.0, multiplier=1.625
```

Ğ¦Ğµ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” Ñ‰Ğ¾ Ğ¼Ğ½Ğ¾Ğ¶Ğ½Ğ¸Ğº `1.625` = Ğ¿Ñ–ĞºĞ¾Ğ²Ğ¸Ğ¹ Ñ‡Ğ°Ñ (1.3) * Ğ¿Ğ¾Ğ¿Ğ¸Ñ‚ (1.25) âœ…

