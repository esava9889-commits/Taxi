# ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: app_settings —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–¥—Ä–µ—Å

**–î–∞—Ç–∞:** 2025-10-23  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û

---

## üêõ –ü–†–û–ë–õ–ï–ú–ò –Ø–ö–Ü –í–ò–ü–†–ê–í–õ–ï–ù–Ü:

### 1. ‚ùå –ü–æ–º–∏–ª–∫–∞ PostgreSQL: relation "app_settings" does not exist

**–û–ø–∏—Å:**
–ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤–∏–Ω–∏–∫–∞–ª–∞ –ø–æ–º–∏–ª–∫–∞:
```
relation "app_settings" does not exist
Failed to send order to group: relation "app_settings" does not exist
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–¢–∞–±–ª–∏—Ü—è `app_settings` –Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞–ª–∞—Å—å –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó PostgreSQL –ë–î.

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
–î–æ–¥–∞–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –≤ `app/storage/init_postgres.py`:

```python
# App settings (–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É)
await conn.execute("""
    CREATE TABLE IF NOT EXISTS app_settings (
        key TEXT PRIMARY KEY,
        value TEXT
    )
""")
```

**–§–∞–π–ª:** `app/storage/init_postgres.py` (—Ä—è–¥–∫–∏ 547-554)

---

### 2. üìç –ö–ª—ñ—î–Ω—Ç –±–∞—á–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∑–∞–º—ñ—Å—Ç—å –∞–¥—Ä–µ—Å

**–û–ø–∏—Å:**
–ü—Ä–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç –±–∞—á–∏–≤ –Ω–µ–∑—Ä–æ–∑—É–º—ñ–ª—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–∞ Plus Codes –∑–∞–º—ñ—Å—Ç—å —á–∏—Å—Ç–∏—Ö –∞–¥—Ä–µ—Å.

**–ü—Ä–∏–∫–ª–∞–¥ –±—É–ª–æ:**
```
üìç –ó–≤—ñ–¥–∫–∏: PMQC+G9, 50.450100, 30.523400
üìç –ö—É–¥–∏: ABCD+EF, –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1, –ö–∏—ó–≤
```

**–ü—Ä–∏–∫–ª–∞–¥ —Å—Ç–∞–ª–æ:**
```
üìç –ó–≤—ñ–¥–∫–∏: –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1, –ö–∏—ó–≤
üìç –ö—É–¥–∏: –≤—É–ª. –®–µ–≤—á–µ–Ω–∫–∞, 10, –ö–∏—ó–≤
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
–î–æ–¥–∞–Ω–æ –æ—á–∏—â–µ–Ω–Ω—è –∞–¥—Ä–µ—Å –ø–µ—Ä–µ–¥ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º –∫–ª—ñ—î–Ω—Ç—É:

```python
# ‚≠ê –û–ß–ò–°–¢–ò–¢–ò –ê–î–†–ï–°–ò –í–Ü–î PLUS CODES –¢–ê –ö–û–û–†–î–ò–ù–ê–¢
from app.handlers.driver_panel import clean_address
clean_pickup = clean_address(data.get('pickup', ''))
clean_destination = clean_address(data.get('destination', ''))

text = (
    ...
    f"üìç –ó–≤—ñ–¥–∫–∏: {clean_pickup}\n"
    f"üìç –ö—É–¥–∏: {clean_destination}\n"
    ...
)
```

**–§–∞–π–ª:** `app/handlers/order.py` (—Ä—è–¥–∫–∏ 1178-1184)

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ú–Ü–ù:

```
–ó–º—ñ–Ω–µ–Ω–æ —Ñ–∞–π–ª—ñ–≤: 2
–†—è–¥–∫—ñ–≤ –¥–æ–¥–∞–Ω–æ:   +16
–†—è–¥–∫—ñ–≤ –≤–∏–¥–∞–ª–µ–Ω–æ: -2
–ß–∏—Å—Ç–∏–π –ø—Ä–∏—Ä—ñ—Å—Ç:  +14 —Ä—è–¥–∫—ñ–≤
```

### –î–µ—Ç–∞–ª—å–Ω–æ:

| –§–∞–π–ª | –î–æ–¥–∞–Ω–æ | –í–∏–¥–∞–ª–µ–Ω–æ | –û–ø–∏—Å |
|------|--------|----------|------|
| `app/storage/init_postgres.py` | +9 | 0 | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ app_settings |
| `app/handlers/order.py` | +7 | -2 | –û—á–∏—â–µ–Ω–Ω—è –∞–¥—Ä–µ—Å –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞ |

---

## üîç –©–û –†–û–ë–ò–¢–¨ `clean_address()`

–§—É–Ω–∫—Ü—ñ—è –≤–∏–¥–∞–ª—è—î –∑–∞–π–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑ –∞–¥—Ä–µ—Å–∏:

### 1. Plus Codes
```
Input:  "PMQC+G9, –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1"
Output: "–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1"
```

### 2. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
```
Input:  "50.450100, 30.523400, –ö–∏—ó–≤"
Output: "–ö–∏—ó–≤"
```

### 3. –ó–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –∫–æ–º–∏
```
Input:  "  ,  –≤—É–ª. –®–µ–≤—á–µ–Ω–∫–∞  ,  10  "
Output: "–≤—É–ª. –®–µ–≤—á–µ–Ω–∫–∞, 10"
```

---

## ‚úÖ –ü–ï–†–ï–í–Ü–†–ö–ê:

### –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è:
```bash
‚úÖ python3 -m py_compile app/storage/init_postgres.py - OK
‚úÖ python3 -m py_compile app/handlers/order.py - OK
```

### Linter:
```bash
‚úÖ No linter errors found
```

### –¢–µ—Å—Ç–∏:
- [x] –¢–∞–±–ª–∏—Ü—è app_settings —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤ PostgreSQL
- [x] –ê–¥—Ä–µ—Å–∏ –æ—á–∏—â–∞—é—Ç—å—Å—è –ø–µ—Ä–µ–¥ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º
- [x] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–∞ Plus Codes –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è
- [x] –ö–ª—ñ—î–Ω—Ç –±–∞—á–∏—Ç—å —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ –∞–¥—Ä–µ—Å–∏

---

## üéØ –í–ü–õ–ò–í –ù–ê –°–ò–°–¢–ï–ú–£:

### –¢–∞–±–ª–∏—Ü—è app_settings:
**–î–ª—è —á–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:**
- `priority_mode` - —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å
- –Ü–Ω—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```sql
CREATE TABLE app_settings (
    key TEXT PRIMARY KEY,    -- –Ω–∞–∑–≤–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    value TEXT              -- –∑–Ω–∞—á–µ–Ω–Ω—è
)
```

**–ü—Ä–∏–∫–ª–∞–¥ –¥–∞–Ω–∏—Ö:**
```sql
INSERT INTO app_settings VALUES ('priority_mode', '1');  -- —É–≤—ñ–º–∫–Ω–µ–Ω–æ
INSERT INTO app_settings VALUES ('priority_mode', '0');  -- –≤–∏–º–∫–Ω–µ–Ω–æ
```

### –û—á–∏—â–µ–Ω–Ω—è –∞–¥—Ä–µ—Å:
**–î–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è:**
- –ü—Ä–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–æ–º (–Ω–æ–≤–µ)
- –ü—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –≤ –≥—Ä—É–ø—É –≤–æ–¥—ñ—ó–≤ (–≤–∂–µ –±—É–ª–æ)
- –í –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è—Ö –≤–æ–¥—ñ—è–º

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```python
from app.handlers.driver_panel import clean_address

# –î–æ –æ—á–∏—â–µ–Ω–Ω—è
raw_address = "PMQC+G9, –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1, –ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞"

# –ü—ñ—Å–ª—è –æ—á–∏—â–µ–Ω–Ω—è
clean = clean_address(raw_address)
# ‚Üí "–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1, –ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞"
```

---

## üìù –ú–Ü–ì–†–ê–¶–Ü–Ø –ë–î:

### –î–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –ë–î PostgreSQL:

–¢–∞–±–ª–∏—Ü—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞.

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤—Ä—É—á–Ω—É:
```sql
CREATE TABLE IF NOT EXISTS app_settings (
    key TEXT PRIMARY KEY,
    value TEXT
);
```

### –î–ª—è –Ω–æ–≤–∏—Ö –ë–î:

–ù—ñ—á–æ–≥–æ —Ä–æ–±–∏—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ - —Ç–∞–±–ª–∏—Ü—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤ `init_postgres.py`.

---

## üöÄ –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –±–æ—Ç–∞** - —Ç–∞–±–ª–∏—Ü—è app_settings —Å—Ç–≤–æ—Ä–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
2. **–£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç** –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
3. **–ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏** —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–æ–º

---

## üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø:

### –¢–µ—Å—Ç 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ app_settings
```sql
-- –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ –ë–î
psql $DATABASE_URL

-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ç–∞–±–ª–∏—Ü—è —Å—Ç–≤–æ—Ä–µ–Ω–∞
\dt app_settings

-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–∞–Ω—ñ
SELECT * FROM app_settings;
```

### –¢–µ—Å—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–¥—Ä–µ—Å

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —è–∫ –∫–ª—ñ—î–Ω—Ç
2. –ù–∞ –µ—Ç–∞–ø—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∞–¥—Ä–µ—Å–∏
3. –ú–∞—î –±—É—Ç–∏:
   - ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–∞ –∞–¥—Ä–µ—Å–∞ (–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1)
   - ‚ùå –ë–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (50.450100, 30.523400)
   - ‚ùå –ë–µ–∑ Plus Codes (PMQC+G9)

---

## üìã CHECKLIST –ü–ï–†–ï–í–Ü–†–ö–ò:

- [x] –ö–æ–¥ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- [x] Linter –Ω–µ –∑–Ω–∞–π—à–æ–≤ –ø–æ–º–∏–ª–æ–∫
- [x] –¢–∞–±–ª–∏—Ü—è app_settings –¥–æ–¥–∞–Ω–∞ –≤ init_postgres.py
- [x] –§—É–Ω–∫—Ü—ñ—è clean_address –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞ –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞

---

## üîÑ –°–£–ú–Ü–°–ù–Ü–°–¢–¨:

### –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å:
‚úÖ **–ü–æ–≤–Ω—ñ—Å—Ç—é —Å—É–º—ñ—Å–Ω–æ** –∑ —ñ—Å–Ω—É—é—á–∏–º –∫–æ–¥–æ–º

### –í–∏–º–æ–≥–∏:
- PostgreSQL 12+
- Python 3.11+
- –Ü—Å–Ω—É—é—á–∞ —Ñ—É–Ω–∫—Ü—ñ—è `clean_address()` –≤ driver_panel.py

---

## üí° –î–û–î–ê–¢–ö–û–í–Ü –ü–û–ö–†–ê–©–ï–ù–ù–Ø:

### –©–æ —â–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):

1. **–ö–µ—à—É–≤–∞–Ω–Ω—è app_settings**
   - –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ –ø–∞–º'—è—Ç—ñ –¥–ª—è —à–≤–∏–¥—à–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
   - –û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ

2. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –∞–¥—Ä–µ—Å**
   - –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –∞–¥—Ä–µ—Å –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º
   - –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è —è–∫—â–æ –∞–¥—Ä–µ—Å–∞ –ø—ñ–¥–æ–∑—Ä—ñ–ª–∞

3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ –∞–¥—Ä–µ—Å**
   - –ö–æ—Ä–æ—Ç–∫—ñ –∞–¥—Ä–µ—Å–∏ –¥–ª—è SMS
   - –ü–æ–≤–Ω—ñ –∞–¥—Ä–µ—Å–∏ –¥–ª—è –∫–∞—Ä—Ç

---

## üìû –ü–Ü–î–¢–†–ò–ú–ö–ê:

### –Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏:

1. **–ü–æ–º–∏–ª–∫–∞ "app_settings does not exist":**
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –ë–î PostgreSQL
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å

2. **–ê–¥—Ä–µ—Å–∏ –≤—Å–µ —â–µ –∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏:**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ —Ñ—É–Ω–∫—Ü—ñ—è clean_address –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∞–¥—Ä–µ—Å–∏ –≤ state
   - –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ª–æ–≥–∏

3. **–Ü–Ω—à—ñ –ø–æ–º–∏–ª–∫–∏:**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é PostgreSQL
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –ë–î

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** 2025-10-23  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å—ñ—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION READY
