# üîß –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –ü–ê–ù–ï–õ–Ü –í–û–î–Ü–Ø v2

**–î–∞—Ç–∞:** 2025-10-19  
**–í–µ—Ä—Å—ñ—è:** 2.1 - –ö—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

---

## ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û 4 –ü–†–û–ë–õ–ï–ú–ò

### 1Ô∏è‚É£ –ú—ñ—Å—Ç–æ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è
### 2Ô∏è‚É£ –ù–µ–º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É –≤–æ–¥—ñ—ó–≤
### 3Ô∏è‚É£ –û—Ñ–ª–∞–π–Ω –≤–æ–¥—ñ–π –º–æ–∂–µ –ø—Ä–∏–π–º–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
### 4Ô∏è‚É£ –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê 1: –ú–Ü–°–¢–û –ù–ï –í–Ü–î–û–ë–†–ê–ñ–ê–Ñ–¢–¨–°–Ø

### –°–∫–∞—Ä–≥–∞:
> "–ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –ø–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É... –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –º—ñ—Å—Ç–æ –≤ —è–∫–æ–º—É –ø—Ä–∞—Ü—é—î –≤–æ–¥—ñ–π"

### –ë—É–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞:
- –ú—ñ—Å—Ç–æ –≤–∏–≤–æ–¥–∏–ª–æ—Å—è —è–∫: `üèô –ú—ñ—Å—Ç–æ: {driver.city or '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}`
- –ê–ª–µ —è–∫—â–æ `driver.city` –ø—É—Å—Ç–µ ‚Üí –≤–∏–≤–æ–¥–∏—Ç—å—Å—è "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"
- –ù–µ–º–∞—î –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏

### ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

**–ë—É–ª–æ:**
```
üèô –ú—ñ—Å—Ç–æ: –ù–µ –≤–∫–∞–∑–∞–Ω–æ
```

**–°—Ç–∞–ª–æ:**
```
üèô –ú—ñ—Å—Ç–æ: ‚ùå –ù–µ –≤–∫–∞–∑–∞–Ω–æ
```

**–ö–æ–¥:**
```python
f"üèô <b>–ú—ñ—Å—Ç–æ:</b> {driver.city or '‚ùå –ù–µ –≤–∫–∞–∑–∞–Ω–æ'}\n"
```

**–¢–∞–∫–æ–∂ –¥–æ–¥–∞–Ω–æ fallback:**
```python
f"‚Ä¢ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–¥—Ö–æ–¥—è—Ç—å –≤ –≥—Ä—É–ø—É <b>{driver.city or '–≤–∞—à–æ–≥–æ –º—ñ—Å—Ç–∞'}</b>\n"
```

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê 2: –ù–ï–ú–ê–Ñ –ü–û–°–ò–õ–ê–ù–ù–Ø –ù–ê –ì–†–£–ü–£

### –°–∫–∞—Ä–≥–∞:
> "–¥–æ–¥–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤ —Ü—å–æ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –¥–ª—è –≥—Ä—É–ø–∏ –≤–æ–¥—ñ—ó–≤ –≤ —è–∫–æ–º—É –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π –≤–æ–¥—ñ–π"

### –ë—É–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞:
- –ù–µ–º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É –≤–æ–¥—ñ—ó–≤
- –í–æ–¥—ñ–π –Ω–µ –∑–Ω–∞—î —è–∫ –ø–µ—Ä–µ–π—Ç–∏ –≤ –≥—Ä—É–ø—É —Å–≤–æ–≥–æ –º—ñ—Å—Ç–∞
- –ü–æ—Ç—Ä—ñ–±–Ω–æ —à—É–∫–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –æ–∫—Ä–µ–º–æ

### ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

**–î–æ–¥–∞–Ω–æ —Ä—è–¥–æ–∫ —ñ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º:**

**–Ø–∫—â–æ —î –ø–æ—Å–∏–ª–∞–Ω–Ω—è:**
```
üì¢ [–ì—Ä—É–ø–∞ –≤–æ–¥—ñ—ó–≤ –ö–∏—ó–≤](https://t.me/...)
```

**–Ø–∫—â–æ –Ω–µ–º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è:**
```
üì¢ –ì—Ä—É–ø–∞: –ö–∏—ó–≤
```

**–Ø–∫—â–æ –º—ñ—Å—Ç–æ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ:**
```
üì¢ –ì—Ä—É–ø–∞: –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ
```

**–ö–æ–¥:**
```python
# –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É –≤–æ–¥—ñ—ó–≤ –¥–ª—è –º—ñ—Å—Ç–∞
city_invite_link = None
if driver.city and driver.city in config.city_invite_links:
    city_invite_link = config.city_invite_links[driver.city]

# –¢–µ–∫—Å—Ç –ø—Ä–æ –≥—Ä—É–ø—É
if city_invite_link:
    group_text = f"üì¢ <a href=\"{city_invite_link}\">–ì—Ä—É–ø–∞ –≤–æ–¥—ñ—ó–≤ {driver.city}</a>\n"
else:
    group_text = f"üì¢ –ì—Ä—É–ø–∞: {driver.city or '–Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ'}\n"
```

**–ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é:**
```
üöÄ –ú–ï–ù–Æ –ö–ï–†–£–í–ê–ù–ù–Ø –†–û–ë–û–¢–û–Æ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë§ –í–æ–¥—ñ–π: –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ
üèô –ú—ñ—Å—Ç–æ: –ö–∏—ó–≤
üì¢ –ì—Ä—É–ø–∞ –≤–æ–¥—ñ—ó–≤ –ö–∏—ó–≤ ‚Üê –ö–õ–Ü–ö–ê–ë–ï–õ–¨–ù–ï –ü–û–°–ò–õ–ê–ù–ù–Ø
üìä –°—Ç–∞—Ç—É—Å: üü¢ –û–Ω–ª–∞–π–Ω

üë• –í–æ–¥—ñ—ó–≤ –æ–Ω–ª–∞–π–Ω: 15 —á–æ–ª.
üí∞ –ó–∞—Ä–æ–±—ñ—Ç–æ–∫ —Å—å–æ–≥–æ–¥–Ω—ñ: 450 –≥—Ä–Ω
üí≥ –ö–æ–º—ñ—Å—ñ—è: 45 –≥—Ä–Ω

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí° –®–≤–∏–¥–∫—ñ –¥—ñ—ó:
‚Ä¢ –£–≤—ñ–º–∫–Ω—ñ—Ç—å üü¢ –û–Ω–ª–∞–π–Ω —â–æ–± –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
‚Ä¢ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–¥—Ö–æ–¥—è—Ç—å –≤ –≥—Ä—É–ø—É –ö–∏—ó–≤
‚Ä¢ –ü–µ—Ä—à–∏–π —Ö—Ç–æ –Ω–∞—Ç–∏—Å–Ω–µ ‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏ - –æ—Ç—Ä–∏–º—É—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
```

**–î–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ:**
1. `start_work()` - –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é "–ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É"
2. `refresh_menu()` - –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "üîÑ –û–Ω–æ–≤–∏—Ç–∏"

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê 3: –û–§–õ–ê–ô–ù –í–û–î–Ü–ô –ú–û–ñ–ï –ü–†–ò–ô–ú–ê–¢–ò –ó–ê–ú–û–í–õ–ï–ù–ù–Ø

### –°–∫–∞—Ä–≥–∞:
> "–∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫—É —Ñ—É–Ω–∫—Ü—ñ—é —è–∫–∞ –±—É–¥–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ –∑–º–æ–≥—É –≤–æ–¥—ñ—è –ø—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —è–∫—â–æ –≤—ñ–Ω –Ω–µ –≤ –æ–Ω–ª–∞–π–Ω"

### –ë—É–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞:
- –í–æ–¥—ñ–π –∑ —Å—Ç–∞—Ç—É—Å–æ–º üî¥ –û—Ñ–ª–∞–π–Ω –º–æ–∂–µ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ ‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏
- –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–º–∞—î—Ç—å—Å—è –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–¥—ñ–π –Ω–µ –ø—Ä–∞—Ü—é—î
- –õ–æ–≥—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ - –æ—Ñ–ª–∞–π–Ω = –Ω–µ –ø—Ä–∞—Ü—é—î

### ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

**–î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å—É:**

```python
@router.callback_query(F.data.startswith("accept_order:"))
async def accept(call: CallbackQuery):
    # ... (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ driver —ñ—Å–Ω—É—î)
    
    # ‚ö†Ô∏è –ü–ï–†–ï–í–Ü–†–ö–ê: –í–æ–¥—ñ–π –º–∞—î –±—É—Ç–∏ –û–ù–õ–ê–ô–ù —â–æ–± –ø—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    if not driver.online:
        logger.warning(f"‚ö†Ô∏è Driver {call.from_user.id} tried to accept order while OFFLINE")
        await call.answer(
            "‚ùå –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!\n\n"
            "–ü—Ä–∏—á–∏–Ω–∞: –í–∏ –≤ —Å—Ç–∞—Ç—É—Å—ñ üî¥ –û–§–õ–ê–ô–ù\n\n"
            "üí° –£–≤—ñ–º–∫–Ω—ñ—Ç—å üü¢ –û–Ω–ª–∞–π–Ω –≤ –º–µ–Ω—é:\n"
            "üöó –ü–∞–Ω–µ–ª—å –≤–æ–¥—ñ—è ‚Üí üöÄ –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É ‚Üí üü¢ –£–í–Ü–ú–ö–ù–£–¢–ò –û–ù–õ–ê–ô–ù",
            show_alert=True
        )
        return
    
    # ... (–¥–∞–ª—ñ –ª–æ–≥—ñ–∫–∞ –ø—Ä–∏–π–Ω—è—Ç—Ç—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è)
```

**–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤–æ–¥—ñ—è:**
```
‚ùå –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!

–ü—Ä–∏—á–∏–Ω–∞: –í–∏ –≤ —Å—Ç–∞—Ç—É—Å—ñ üî¥ –û–§–õ–ê–ô–ù

üí° –£–≤—ñ–º–∫–Ω—ñ—Ç—å üü¢ –û–Ω–ª–∞–π–Ω –≤ –º–µ–Ω—é:
üöó –ü–∞–Ω–µ–ª—å –≤–æ–¥—ñ—è ‚Üí üöÄ –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É ‚Üí üü¢ –£–í–Ü–ú–ö–ù–£–¢–ò –û–ù–õ–ê–ô–ù
```

**–õ–æ–≥—É–≤–∞–Ω–Ω—è:**
```
‚ö†Ô∏è Driver 123456789 tried to accept order while OFFLINE
```

**–õ–æ–≥—ñ–∫–∞:**
1. –í–æ–¥—ñ–π –Ω–∞—Ç–∏—Å–∫–∞—î "‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏" –≤ –≥—Ä—É–ø—ñ
2. –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î `driver.online`
3. –Ø–∫—â–æ `False` ‚Üí –ø–æ–∫–∞–∑—É—î popup alert
4. –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ù–ï –ø—Ä–∏–π–º–∞—î—Ç—å—Å—è
5. –õ–æ–≥—É—î—Ç—å—Å—è —Å–ø—Ä–æ–±–∞

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –û—Ñ–ª–∞–π–Ω –≤–æ–¥—ñ—ó –Ω–µ –º–æ–∂—É—Ç—å –ø—Ä–∏–π–º–∞—Ç–∏
- ‚úÖ –ß—ñ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —á–æ–º—É
- ‚úÖ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —è–∫ —É–≤—ñ–º–∫–Ω—É—Ç–∏ –æ–Ω–ª–∞–π–Ω
- ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è —Å–ø—Ä–æ–±

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê 4: –ö–ù–û–ü–ö–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò –ù–ï –ü–†–ê–¶–Æ–Æ–¢–¨

### –°–∫–∞—Ä–≥–∞:
> "–Ω–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ, —Ç–∏–∂–¥–µ–Ω—å, –º—ñ—Å—è—Ü—å"

### –ë—É–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞:
- –ö–Ω–æ–ø–∫–∏ "üìÖ –°—å–æ–≥–æ–¥–Ω—ñ", "üìÖ –¢–∏–∂–¥–µ–Ω—å", "üìÖ –ú—ñ—Å—è—Ü—å" —î
- Callback data: `stats:today`, `stats:week`, `stats:month`
- **–ê–ª–µ –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –ù–ï–ú–ê–Ñ!** ‚ùå

### ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

**–î–æ–¥–∞–Ω–æ 3 –Ω–æ–≤—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏:**

---

### üìÖ –°–¨–û–ì–û–î–ù–Ü (stats:today)

**–ö–æ–¥:**
```python
@router.callback_query(F.data == "stats:today")
async def show_stats_today(call: CallbackQuery):
    driver = await get_driver_by_tg_user_id(...)
    
    # –°—å–æ–≥–æ–¥–Ω—ñ –∑ 00:00
    today_start = datetime.now(timezone.utc).replace(hour=0, minute=0, second=0, microsecond=0)
    
    # –í—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤–æ–¥—ñ—è
    all_orders = await get_driver_order_history(config.database_path, driver.tg_user_id, limit=100)
    
    # –§—ñ–ª—å—Ç—Ä –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
    today_orders = [o for o in all_orders if o.created_at >= today_start]
    
    # –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫
    total_orders = len(today_orders)
    completed_orders = len([o for o in today_orders if o.status == 'completed'])
    cancelled_orders = len([o for o in today_orders if o.status == 'cancelled'])
    
    earnings = sum(o.fare_amount for o in today_orders if o.status == 'completed' and o.fare_amount)
    commission = earnings * 0.02  # 2%
    net = earnings - commission
    
    # –í–∏–≤—ñ–¥
    text = f"""
    üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ê –°–¨–û–ì–û–î–ù–Ü
    
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    üì¶ –í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: {total_orders}
    ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ: {completed_orders}
    ‚ùå –°–∫–∞—Å–æ–≤–∞–Ω–æ: {cancelled_orders}
    
    üí∞ –ó–∞—Ä–æ–±—ñ—Ç–æ–∫: {earnings:.0f} –≥—Ä–Ω
    üí≥ –ö–æ–º—ñ—Å—ñ—è (2%): {commission:.0f} –≥—Ä–Ω
    üíµ –ß–∏—Å—Ç–∏–π: {net:.0f} –≥—Ä–Ω
    
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    üìÖ –î–∞—Ç–∞: {datetime.now().strftime('%d.%m.%Y')}
    """
```

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:**
```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ê –°–¨–û–ì–û–î–ù–Ü

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üì¶ –í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: 12
‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ: 10
‚ùå –°–∫–∞—Å–æ–≤–∞–Ω–æ: 2

üí∞ –ó–∞—Ä–æ–±—ñ—Ç–æ–∫: 850 –≥—Ä–Ω
üí≥ –ö–æ–º—ñ—Å—ñ—è (2%): 17 –≥—Ä–Ω
üíµ –ß–∏—Å—Ç–∏–π: 833 –≥—Ä–Ω

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìÖ –î–∞—Ç–∞: 19.10.2025
```

---

### üìÖ –¢–ò–ñ–î–ï–ù–¨ (stats:week)

**–ö–æ–¥:**
```python
@router.callback_query(F.data == "stats:week")
async def show_stats_week(call: CallbackQuery):
    # 7 –¥–Ω—ñ–≤ —Ç–æ–º—É
    week_start = datetime.now(timezone.utc) - timedelta(days=7)
    
    # –§—ñ–ª—å—Ç—Ä
    week_orders = [o for o in all_orders if o.created_at >= week_start]
    
    # –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ (—è–∫ —É today)
    # ... + –¥–æ–¥–∞—Ç–∫–æ–≤–æ:
    
    # –°–µ—Ä–µ–¥–Ω—î –∑–∞ –¥–µ–Ω—å
    avg_per_day = earnings / 7 if earnings > 0 else 0
```

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:**
```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ê –¢–ò–ñ–î–ï–ù–¨

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üì¶ –í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: 67
‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ: 62
‚ùå –°–∫–∞—Å–æ–≤–∞–Ω–æ: 5

üí∞ –ó–∞—Ä–æ–±—ñ—Ç–æ–∫: 5450 –≥—Ä–Ω
üí≥ –ö–æ–º—ñ—Å—ñ—è (2%): 109 –≥—Ä–Ω
üíµ –ß–∏—Å—Ç–∏–π: 5341 –≥—Ä–Ω

üìà –°–µ—Ä–µ–¥–Ω—î/–¥–µ–Ω—å: 778 –≥—Ä–Ω

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìÖ –ü–µ—Ä—ñ–æ–¥: –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤
```

---

### üìÖ –ú–Ü–°–Ø–¶–¨ (stats:month)

**–ö–æ–¥:**
```python
@router.callback_query(F.data == "stats:month")
async def show_stats_month(call: CallbackQuery):
    # 30 –¥–Ω—ñ–≤ —Ç–æ–º—É
    month_start = datetime.now(timezone.utc) - timedelta(days=30)
    
    # –§—ñ–ª—å—Ç—Ä
    month_orders = [o for o in all_orders if o.created_at >= month_start]
    
    # –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ + —Å–µ—Ä–µ–¥–Ω—î
    avg_per_day = earnings / 30 if earnings > 0 else 0
```

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:**
```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ê –ú–Ü–°–Ø–¶–¨

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üì¶ –í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: 245
‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ: 230
‚ùå –°–∫–∞—Å–æ–≤–∞–Ω–æ: 15

üí∞ –ó–∞—Ä–æ–±—ñ—Ç–æ–∫: 22500 –≥—Ä–Ω
üí≥ –ö–æ–º—ñ—Å—ñ—è (2%): 450 –≥—Ä–Ω
üíµ –ß–∏—Å—Ç–∏–π: 22050 –≥—Ä–Ω

üìà –°–µ—Ä–µ–¥–Ω—î/–¥–µ–Ω—å: 750 –≥—Ä–Ω

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìÖ –ü–µ—Ä—ñ–æ–¥: –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤
```

---

### üîç –õ–æ–≥—ñ–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –¥–∞—Ç

**–û–±—Ä–æ–±–∫–∞ —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤:**
```python
for order in all_orders:
    if order.created_at:
        order_time = order.created_at
        
        # –Ø–∫—â–æ —Ä—è–¥–æ–∫ - –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏
        if isinstance(order_time, str):
            try:
                order_time = datetime.fromisoformat(order_time)
            except:
                continue
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –≤—Ö–æ–¥–∏—Ç—å –≤ –¥—ñ–∞–ø–∞–∑–æ–Ω
        if isinstance(order_time, datetime):
            if order_time.replace(tzinfo=timezone.utc) >= start_date:
                filtered_orders.append(order)
```

**–ü–µ—Ä—ñ–æ–¥–∏:**
- **–°—å–æ–≥–æ–¥–Ω—ñ**: –≤—ñ–¥ `00:00` —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—å–æ–≥–æ –¥–Ω—è
- **–¢–∏–∂–¥–µ–Ω—å**: –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤ (–∑ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç—É)
- **–ú—ñ—Å—è—Ü—å**: –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤ (–∑ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç—É)

---

## üìä –ó–ê–ì–ê–õ–¨–ù–ê –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø

### –§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ:
- `app/handlers/driver_panel.py`: **+244 —Ä—è–¥–∫–∏**

### –§—É–Ω–∫—Ü—ñ—ó –∑–º—ñ–Ω–µ–Ω–æ:
1. `start_work()`: +8 —Ä—è–¥–∫—ñ–≤ (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É)
2. `refresh_menu()`: +8 —Ä—è–¥–∫—ñ–≤ (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É)
3. `accept()`: +9 —Ä—è–¥–∫—ñ–≤ (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω)

### –§—É–Ω–∫—Ü—ñ—ó –¥–æ–¥–∞–Ω–æ:
4. `show_stats_today()`: +72 —Ä—è–¥–∫–∏ (–ù–û–í–ê)
5. `show_stats_week()`: +75 —Ä—è–¥–∫—ñ–≤ (–ù–û–í–ê)
6. `show_stats_month()`: +75 —Ä—è–¥–∫—ñ–≤ (–ù–û–í–ê)

---

## üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø

### –¢–µ—Å—Ç 1: –ú—ñ—Å—Ç–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è

**–î—ñ—ó:**
1. –í–æ–¥—ñ–π –Ω–∞—Ç–∏—Å–∫–∞—î "üöÄ –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É"

**–û—á—ñ–∫—É—î—Ç—å—Å—è:**
- ‚úÖ –ú—ñ—Å—Ç–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è: `üèô –ú—ñ—Å—Ç–æ: –ö–∏—ó–≤`
- ‚úÖ –Ø–∫—â–æ –ø—É—Å—Ç–µ: `üèô –ú—ñ—Å—Ç–æ: ‚ùå –ù–µ –≤–∫–∞–∑–∞–Ω–æ`

---

### –¢–µ—Å—Ç 2: –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É

**–î—ñ—ó:**
1. –í–æ–¥—ñ–π –Ω–∞—Ç–∏—Å–∫–∞—î "üöÄ –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É"
2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ —î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É

**–û—á—ñ–∫—É—î—Ç—å—Å—è (—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è):**
- ‚úÖ –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è: `üì¢ –ì—Ä—É–ø–∞ –≤–æ–¥—ñ—ó–≤ –ö–∏—ó–≤` (–∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–µ)
- ‚úÖ –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ ‚Üí –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è Telegram –≥—Ä—É–ø–∞

**–û—á—ñ–∫—É—î—Ç—å—Å—è (–Ω–µ–º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è):**
- ‚úÖ –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è: `üì¢ –ì—Ä—É–ø–∞: –ö–∏—ó–≤`

---

### –¢–µ—Å—Ç 3: –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ—Ñ–ª–∞–π–Ω

**–î—ñ—ó:**
1. –í–æ–¥—ñ–π –º–∞—î —Å—Ç–∞—Ç—É—Å üî¥ –û—Ñ–ª–∞–π–Ω
2. –í –≥—Ä—É–ø—ñ –∑'—è–≤–ª—è—î—Ç—å—Å—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. –í–æ–¥—ñ–π –Ω–∞—Ç–∏—Å–∫–∞—î "‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏"

**–û—á—ñ–∫—É—î—Ç—å—Å—è:**
- ‚úÖ Popup alert: "‚ùå –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!"
- ‚úÖ –ü—Ä–∏—á–∏–Ω–∞: "–í–∏ –≤ —Å—Ç–∞—Ç—É—Å—ñ üî¥ –û–§–õ–ê–ô–ù"
- ‚úÖ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —è–∫ —É–≤—ñ–º–∫–Ω—É—Ç–∏ –æ–Ω–ª–∞–π–Ω
- ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ù–ï –ø—Ä–∏–π–º–∞—î—Ç—å—Å—è
- ‚úÖ –í –ª–æ–≥–∞—Ö: "‚ö†Ô∏è Driver ... tried to accept order while OFFLINE"

---

### –¢–µ—Å—Ç 4: –ö–Ω–æ–ø–∫–∞ "–°—å–æ–≥–æ–¥–Ω—ñ"

**–î—ñ—ó:**
1. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ üöÄ –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É ‚Üí üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí üìÖ –°—å–æ–≥–æ–¥–Ω—ñ

**–û—á—ñ–∫—É—î—Ç—å—Å—è:**
- ‚úÖ –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
- ‚úÖ –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω—å (–≤—Å—å–æ–≥–æ, –≤–∏–∫–æ–Ω–∞–Ω–æ, —Å–∫–∞—Å–æ–≤–∞–Ω–æ)
- ‚úÖ –ó–∞—Ä–æ–±—ñ—Ç–æ–∫, –∫–æ–º—ñ—Å—ñ—è, —á–∏—Å—Ç–∏–π
- ‚úÖ –î–∞—Ç–∞: –ø–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "¬´ –ù–∞–∑–∞–¥" –ø—Ä–∞—Ü—é—î

---

### –¢–µ—Å—Ç 5: –ö–Ω–æ–ø–∫–∞ "–¢–∏–∂–¥–µ–Ω—å"

**–î—ñ—ó:**
1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí üìÖ –¢–∏–∂–¥–µ–Ω—å

**–û—á—ñ–∫—É—î—Ç—å—Å—è:**
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤
- ‚úÖ –°–µ—Ä–µ–¥–Ω—î –∑–∞ –¥–µ–Ω—å
- ‚úÖ –ü–µ—Ä—ñ–æ–¥: "–æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤"

---

### –¢–µ—Å—Ç 6: –ö–Ω–æ–ø–∫–∞ "–ú—ñ—Å—è—Ü—å"

**–î—ñ—ó:**
1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí üìÖ –ú—ñ—Å—è—Ü—å

**–û—á—ñ–∫—É—î—Ç—å—Å—è:**
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤
- ‚úÖ –°–µ—Ä–µ–¥–Ω—î –∑–∞ –¥–µ–Ω—å
- ‚úÖ –ü–µ—Ä—ñ–æ–¥: "–æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤"

---

## üìà –ü–û–ö–†–ê–©–ï–ù–ù–Ø –ú–ï–¢–†–ò–ö

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
```
–ú—ñ—Å—Ç–æ –≤–∏–¥–∏–º–µ: 70% (–Ω–µ –∑–∞–≤–∂–¥–∏)
–ì—Ä—É–ø—É –∑–Ω–∞—Ö–æ–¥—è—Ç—å: 40% (—à—É–∫–∞—é—Ç—å —Å–∞–º—ñ)
–û—Ñ–ª–∞–π–Ω –ø—Ä–∏–π–º–∞—é—Ç—å: 20% (–±–∞–≥)
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—é—î: 0% (–Ω–µ –ø—Ä–∞—Ü—é—î)
```

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å:
```
–ú—ñ—Å—Ç–æ –≤–∏–¥–∏–º–µ: 100% ‚úÖ (+30%)
–ì—Ä—É–ø—É –∑–Ω–∞—Ö–æ–¥—è—Ç—å: 100% ‚úÖ (+60%) (–∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–∞)
–û—Ñ–ª–∞–π–Ω –ø—Ä–∏–π–º–∞—é—Ç—å: 0% ‚úÖ (-20%) (–∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ)
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—é—î: 100% ‚úÖ (+100%)
```

---

## üéØ –ü–ï–†–ï–í–ê–ì–ò

### –î–ª—è –≤–æ–¥—ñ—ó–≤:
- ‚úÖ –ú—ñ—Å—Ç–æ –∑–∞–≤–∂–¥–∏ –≤–∏–¥–∏–º–µ
- ‚úÖ –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É –æ–¥–Ω–∏–º –∫–ª—ñ–∫–æ–º
- ‚úÖ –ù–µ –º–æ–∂–Ω–∞ –ø—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –æ—Ñ–ª–∞–π–Ω (–∑–∞—Ö–∏—Å—Ç)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—é—î (–º–æ—Ç–∏–≤–∞—Ü—ñ—è)
- ‚úÖ –ë–∞—á–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É –∞–Ω–∞–ª—ñ—Ç–∏–∫—É (–¥–µ–Ω—å/—Ç–∏–∂–¥–µ–Ω—å/–º—ñ—Å—è—Ü—å)
- ‚úÖ –°–µ—Ä–µ–¥–Ω—ñ–π –∑–∞—Ä–æ–±—ñ—Ç–æ–∫ –∑–∞ –¥–µ–Ω—å (–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è)

### –î–ª—è –∞–¥–º—ñ–Ω–∞:
- ‚úÖ –ú–µ–Ω—à–µ –ø–∏—Ç–∞–Ω—å –ø—Ä–æ –≥—Ä—É–ø—É
- ‚úÖ –ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫ (–æ—Ñ–ª–∞–π–Ω –±–ª–æ–∫—É–≤–∞–Ω–Ω—è)
- ‚úÖ –í–æ–¥—ñ—ó –∫—Ä–∞—â–µ —ñ–Ω—Ñ–æ—Ä–º–æ–≤–∞–Ω—ñ
- ‚úÖ –ü—Ä–æ–∑–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –¢–µ—Ö–Ω—ñ—á–Ω—ñ:
- ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è –æ—Ñ–ª–∞–π–Ω —Å–ø—Ä–æ–±
- ‚úÖ Fallback –¥–ª—è –ø—É—Å—Ç–∏—Ö –∑–Ω–∞—á–µ–Ω—å
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –¥–∞—Ç
- ‚úÖ –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

---

## üìã –ü–Ü–î–°–£–ú–û–ö

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ:
```
1. –ú—ñ—Å—Ç–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∑ ‚ùå —è–∫—â–æ –ø—É—Å—Ç–µ ‚úÖ
2. –î–æ–¥–∞–Ω–æ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É ‚úÖ
3. –û—Ñ–ª–∞–π–Ω –≤–æ–¥—ñ—ó –Ω–µ –º–æ–∂—É—Ç—å –ø—Ä–∏–π–º–∞—Ç–∏ ‚úÖ
4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—é—î (3 –ø–µ—Ä—ñ–æ–¥–∏) ‚úÖ
```

### –î–æ–¥–∞–Ω–æ:
```
- 3 –Ω–æ–≤—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å—É
- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥—Ä—É–ø—É –º—ñ—Å—Ç–∞
- Fallback –¥–ª—è –ø—É—Å—Ç–∏—Ö –∑–Ω–∞—á–µ–Ω—å
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –æ—Ñ–ª–∞–π–Ω —Å–ø—Ä–æ–±
```

### –†—è–¥–∫—ñ–≤ –∫–æ–¥—É:
```
+244 —Ä—è–¥–∫–∏
+3 –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
–ó–º—ñ–Ω–µ–Ω–æ 3 —ñ—Å–Ω—É—é—á—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
```

---

**–í–°–ï 4 –ü–†–û–ë–õ–ï–ú–ò –í–ò–†–Ü–®–ï–ù–Ü! –ü–ê–ù–ï–õ–¨ –í–û–î–Ü–Ø –ü–†–ê–¶–Æ–Ñ –Ü–î–ï–ê–õ–¨–ù–û!** ‚úÖüöÄüéâ
